window.__require=function e(t,o,s){function a(r,c){if(!o[r]){if(!t[r]){var n=r.split("/");if(n=n[n.length-1],!t[n]){var l="function"==typeof __require&&__require;if(!c&&l)return l(n,!0);if(i)return i(n,!0);throw new Error("Cannot find module '"+r+"'")}r=n}var d=o[r]={exports:{}};t[r][0].call(d.exports,function(e){return a(t[r][1][e]||e)},d,d.exports,e,t,o,s)}return o[r].exports}for(var i="function"==typeof __require&&__require,r=0;r<s.length;r++)a(s[r]);return a}({ActionManager:[function(e,t,o){"use strict";cc._RF.push(t,"a25cbaMcu1BlZadjF54ho3f","ActionManager"),Object.defineProperty(o,"__esModule",{value:!0}),o.ActionManager=void 0;const s=e("core/gameloop/GameLoopPhase");o.ActionManager=class{constructor(e){this.updatePhase=s.GameLoopPhase.LOGIC,this._paused=!1,this._active=new Set,this._activeCallbacks=new Map,this.name=e}get paused(){return this._paused}start(e){if(this._active.has(e)){const t=this._activeCallbacks.get(e);return Promise.resolve(t.resolver)}this._active.add(e);const t=new Promise(e=>{o.onCancel=()=>e("cancelled"),o.onComplete=()=>e("completed")}),o={onCancel:()=>{},onComplete:()=>{},resolver:t};return this._activeCallbacks.set(e,o),t}pause(){this._paused=!0}resume(){this._paused=!1}_cancel(e){this._active.has(e)&&(e.cancel(),this._resolveAndClear(e))}cancelAll(){for(const e of this._active)this._cancel(e)}cancelAllByTag(e){for(const t of this._active)t.id===e&&this._cancel(t)}update(e){var t;if(!this._paused)for(const o of this._active)o.completed||o.canceled?this._resolveAndClear(o):(null===(t=o.update)||void 0===t||t.call(o,e),o.completed&&this._resolveAndClear(o))}_resolveAndClear(e){if(this._active.delete(e)){const t=this._activeCallbacks.get(e);this._activeCallbacks.delete(e),e.completed?t.onComplete():e.canceled&&t.onCancel()}}},cc._RF.pop()},{"core/gameloop/GameLoopPhase":void 0}],Action:[function(e,t,o){"use strict";cc._RF.push(t,"baba77CMwNA7bjvehF5osxY","Action"),Object.defineProperty(o,"__esModule",{value:!0}),o.Action=void 0,o.Action=class{constructor(e=""){this.canceled=!1,this.completed=!1,this.id=e}cancel(e){var t;this.canceled||(this.completed=e||this.completed,this.canceled=!0,null===(t=this.doCancel)||void 0===t||t.call(this)),this._tryResolveFinished()}update(e){var t;this.completed||this.canceled||(null===(t=this.doUpdate)||void 0===t||t.call(this,e),this.checkIsCompleteAfterUpdate()&&(this.completed=!0,this._tryResolveFinished()))}waitFinish(){if(delete this._finishResolver,this.completed)return Promise.resolve("completed");if(this.canceled)return Promise.resolve("cancelled");const e=new Promise(e=>{t.onCancel=()=>e("cancelled"),t.onComplete=()=>e("completed")}),t={onCancel:()=>{},onComplete:()=>{}};return this._finishResolver=t,e}_tryResolveFinished(){this._finishResolver&&(this.completed?(this._finishResolver.onComplete(),delete this._finishResolver):this.canceled&&(this._finishResolver.onCancel(),delete this._finishResolver))}},cc._RF.pop()},{}],AnimationManager:[function(e,t,o){"use strict";cc._RF.push(t,"1f274N1ihZMoZGonJYUIc7m","AnimationManager"),Object.defineProperty(o,"__esModule",{value:!0}),o.AnimationManager=void 0;const s=e("core/gameloop/GameLoopPhase");o.AnimationManager=class{constructor(e){this.updatePhase=s.GameLoopPhase.ANIMATION,this._paused=!1,this.name=e}get paused(){return this._paused}pause(){this._paused=!0}resume(){this._paused=!1}start(e){return console.log(e),Promise.resolve()}cancel(){}cancelAll(e){console.log(e)}cancelAllByTag(e,t){console.log(e,t)}update(e){console.log(e)}},cc._RF.pop()},{"core/gameloop/GameLoopPhase":void 0}],AudioVoice:[function(e,t,o){"use strict";cc._RF.push(t,"f64f4HCZUVO+Kuj1NaIyLVA","AudioVoice"),Object.defineProperty(o,"__esModule",{value:!0}),o.AudioVoice=void 0,o.AudioVoice=class{constructor(e,t){this.onUpdateCallbacks={add:e=>{var t;this._listeners.add(e),null===(t=this._masterVoice)||void 0===t||t.onUpdateCallbacks.add(this)},delete:e=>{var t;const o=this._listeners.delete(e);return 0==this._listeners.size&&(null===(t=this._masterVoice)||void 0===t||t.onUpdateCallbacks.delete(this)),o}},this._muted=!1,this._volume=1,this._listeners=new Set,this.name=e,this._masterVoice=t}get muted(){return this._muted||!!this._masterVoice&&this._masterVoice.muted}get volume(){return this._volume*(this._masterVoice?this._masterVoice.volume:1)}mute(){this._muted||(this._muted=!0,this._dispatchUpdate())}unmute(){this._muted&&(this._muted=!1,this._dispatchUpdate())}setVolume(e){this._volume!=e&&(this._volume=Math.max(0,Math.min(1,e)),this._dispatchUpdate())}_dispatchUpdate(){for(const e of this._listeners)e.onUpdateVoice(this)}onUpdateVoice(){this._dispatchUpdate()}},cc._RF.pop()},{}],BlockActionBase:[function(e,t,o){"use strict";cc._RF.push(t,"fc1d8VeJN9IILKQuM8kq6Ni","BlockActionBase"),Object.defineProperty(o,"__esModule",{value:!0}),o.BlockActionBase=void 0,o.BlockActionBase=class{constructor(e){this.markSectorAsIncluded=e=>{const[t,o]=e;return!this._includedSectors[t-1][o-1]&&(this._includedSectors[t-1][o-1]=!0,!0)},this.blockType=e,this._includedSectors=[]}resetIncludedSectors(e,t){this._includedSectors=Array(e).fill(void 0).map(()=>Array(t).fill(void 0))}},cc._RF.pop()},{}],BlockColorType:[function(e,t,o){"use strict";cc._RF.push(t,"b8010bjPbFOhJN7IdxMOB3S","BlockColorType"),Object.defineProperty(o,"__esModule",{value:!0}),o.getSimpleBlockIndex=o.isSimpleBlock=o.BlockColorTypes=o.BlockColorType=void 0,o.BlockColorType={RED:1,YELLOW:2,GREEN:3,PINK:4,BLUE:5},o.BlockColorTypes=Object.values(o.BlockColorType),o.isSimpleBlock=e=>-1!=o.BlockColorTypes.indexOf(e),o.getSimpleBlockIndex=e=>o.BlockColorTypes.indexOf(e),cc._RF.pop()},{}],BlockSpecialType:[function(e,t,o){"use strict";cc._RF.push(t,"154f8+jkHJCPIpK8wmpDyEL","BlockSpecialType"),Object.defineProperty(o,"__esModule",{value:!0}),o.getSpecialBlockIndex=o.isSpecialBlock=o.BlockSpecialTypes=o.BlockSpecialType=o.SpecialBlockTypeMask=void 0,o.SpecialBlockTypeMask=8,o.BlockSpecialType={BOMB:8,BOMB_MAX:9,ROCKET_VERTICAL:10,ROCKET_HORIZONTAL:11},o.BlockSpecialTypes=Object.values(o.BlockSpecialType),o.isSpecialBlock=e=>-1!=o.BlockSpecialTypes.indexOf(e),o.getSpecialBlockIndex=e=>o.isSpecialBlock(e)?e^o.SpecialBlockTypeMask:-1,cc._RF.pop()},{}],BlocksField:[function(e,t,o){"use strict";cc._RF.push(t,"f6fbfrUda9CEItsC4hnQLw1","BlocksField"),Object.defineProperty(o,"__esModule",{value:!0}),o.BlocksField=o.isBlockTypeData=void 0;const s=e("game/logic/field/FieldData");o.isBlockTypeData=e=>-1!=e,o.BlocksField=class extends s.FieldData{constructor(e){super(e.rowsCount,e.columnsCount,-1)}getEmptyRowsAtColumn(e,t){const o=[];if(t)for(let s=1;s<=this.rows;s++)this.hasDataAt(s,e)||o.push(s);else for(let s=this.rows;s>=1&&!this.hasDataAt(s,e);s--)o.push(s);return o}},cc._RF.pop()},{"game/logic/field/FieldData":void 0}],BlocksPreview:[function(e,t,o){"use strict";cc._RF.push(t,"319cejCTKdHLYRQju/+MaST","BlocksPreview");var s=this&&this.__decorate||function(e,t,o,s){var a,i=arguments.length,r=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,s);else for(var c=e.length-1;c>=0;c--)(a=e[c])&&(r=(i<3?a(r):i>3?a(t,o,r):a(t,o))||r);return i>3&&r&&Object.defineProperty(t,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});const{ccclass:a}=cc._decorator;let i=class extends cc.Component{onLoad(){this.node.destroy()}};i=s([a],i),o.default=i,cc._RF.pop()},{}],BlocksSet:[function(e,t,o){"use strict";cc._RF.push(t,"e08e7r1VQxHAqxlLFHfqdH5","BlocksSet");var s=this&&this.__decorate||function(e,t,o,s){var a,i=arguments.length,r=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,s);else for(var c=e.length-1;c>=0;c--)(a=e[c])&&(r=(i<3?a(r):i>3?a(t,o,r):a(t,o))||r);return i>3&&r&&Object.defineProperty(t,o,r),r},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(o,"__esModule",{value:!0}),o.BlocksSet=void 0;var i=cc._decorator.ccclass,r=cc._decorator.disallowMultiple,c=cc._decorator.property;const n=e("game/logic/blocks/BlockColorType"),l=e("game/logic/blocks/BlockSpecialType");let d=class extends cc.Component{constructor(){super(...arguments),this.simpleBlocksList=[],this.specialBlocksList=[]}resetInEditor(){0===this.simpleBlocksList.length&&(this.simpleBlocksList=new Array(Object.keys(n.BlockColorType).length).fill(null)),0===this.specialBlocksList.length&&(this.specialBlocksList=new Array(Object.keys(l.BlockSpecialType).length).fill(null))}};s([c({type:[cc.Prefab],tooltip:"Set of simple colored blocks (Fixed length 5)",displayName:"Colored block"}),a("design:type",Array)],d.prototype,"simpleBlocksList",void 0),s([c({type:[cc.Prefab],tooltip:"Set of special blocks (Fixed length 4)",displayName:"Special block"}),a("design:type",Array)],d.prototype,"specialBlocksList",void 0),d=s([i,r],d),o.BlocksSet=d,cc._RF.pop()},{"game/logic/blocks/BlockColorType":void 0,"game/logic/blocks/BlockSpecialType":void 0}],Block:[function(e,t,o){"use strict";cc._RF.push(t,"2bb1a2t7X5Anrk9i/Ng/vps","Block");var s=this&&this.__decorate||function(e,t,o,s){var a,i=arguments.length,r=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,s);else for(var c=e.length-1;c>=0;c--)(a=e[c])&&(r=(i<3?a(r):i>3?a(t,o,r):a(t,o))||r);return i>3&&r&&Object.defineProperty(t,o,r),r},a=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))(function(a,i){function r(e){try{n(s.next(e))}catch(t){i(t)}}function c(e){try{n(s.throw(e))}catch(t){i(t)}}function n(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(r,c)}n((s=s.apply(e,t||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0}),o.Block=void 0;var i=cc._decorator.ccclass;const r=e("@cc_platform/animation/CCSequentAnimationPlayer");let c=class extends cc.Component{constructor(){super(...arguments),this._animationsPlaying=new Set}onLoad(){const e=this.getComponent(cc.Animation);let t=0;this._appearAnimId=e.getClips()[t++].name,this._disappearAnimId=e.getClips()[t++].name,this._fallenDownAnimId=e.getClips()[t++].name,this._shakeAnimId=e.getClips()[t++].name,this._player=new r.CCSequentAnimationPlayer(e)}startAppearAnim(){return a(this,void 0,void 0,function*(){yield this._playAnimation(this._appearAnimId,this.onAppearAnimationComplete)})}startDisappearAnim(){return a(this,void 0,void 0,function*(){yield this._playAnimation(this._disappearAnimId,this.onDisappearAnimationComplete)})}startFallenDowAnim(){return a(this,void 0,void 0,function*(){yield this._playAnimation(this._fallenDownAnimId,this.onFallenDownAnimationComplete)})}playShakeAnim(){this._animationsPlaying.size||this._playAnimation(this._shakeAnimId)}_playAnimation(e,t){return a(this,void 0,void 0,function*(){this._animationsPlaying.has(e)||(this._animationsPlaying.add(e),yield this._player.start(e).then(()=>{this._animationsPlaying.delete(e),null==t||t()}).catch(()=>{this._animationsPlaying.delete(e)}))})}};c=s([i],c),o.Block=c,cc._RF.pop()},{"@cc_platform/animation/CCSequentAnimationPlayer":void 0}],BoardPrepareToGame:[function(e,t,o){"use strict";cc._RF.push(t,"e0bfbmd/GBDCLct6VlD36nJ","BoardPrepareToGame");var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))(function(a,i){function r(e){try{n(s.next(e))}catch(t){i(t)}}function c(e){try{n(s.throw(e))}catch(t){i(t)}}function n(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(r,c)}n((s=s.apply(e,t||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0}),o.BoardPrepareToGame=void 0,o.BoardPrepareToGame=class{constructor(e,t){this._boardView=e,this._clearAndFillMethod=t}perform(){return s(this,void 0,void 0,function*(){yield this._clearAndFillBoard()})}_clearAndFillBoard(){return s(this,void 0,void 0,function*(){const e=this._clearAndFillMethod.execute();yield this._boardView.fillWithInitialBlocks(this._clearAndFillMethod.blocksData,e)})}},cc._RF.pop()},{}],BoardReady:[function(e,t,o){"use strict";cc._RF.push(t,"e6219NeqD1DaqwC8PsVZaPi","BoardReady"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoardReady=void 0;const s=e("game/state/game-flow-state"),a=e("game/state/GameFlowStateBase"),i=e("game/state/GameFlowStateID");o.BoardReady=class extends a.GameFlowStateBase{constructor(e,t,o,s,a){super(!1,e,t,o,s,a),this.stateId=i.GameplayStateID.BOARD_READY}goReadyBoard(){return s.ignoreTransition()}goPlayerTurn(){return this.transitToState(i.GameplayStateID.PLAYER_TURN,void 0)}},cc._RF.pop()},{"game/state/GameFlowStateBase":void 0,"game/state/GameFlowStateID":void 0,"game/state/game-flow-state":void 0}],BoardRefillEmptySectors:[function(e,t,o){"use strict";cc._RF.push(t,"f81e95+ChJDHq/ffmQMZwy+","BoardRefillEmptySectors");var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))(function(a,i){function r(e){try{n(s.next(e))}catch(t){i(t)}}function c(e){try{n(s.throw(e))}catch(t){i(t)}}function n(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(r,c)}n((s=s.apply(e,t||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0}),o.BoardRefillEmptySectors=void 0,o.BoardRefillEmptySectors=class{constructor(e,t,o,s){this._boardView=e,this._fallFromMethod=t,this._fallToEmptyMethod=o,this._refillByNewMethod=s}perform(){return s(this,void 0,void 0,function*(){yield this._dropDownAndFillEmpty()})}_dropDownAndFillEmpty(){return s(this,void 0,void 0,function*(){const e=this._fallFromMethod.execute(),t=this._fallToEmptyMethod.execute();yield this._boardView.fallDownBlocksToEmpty(e,t);const o=this._refillByNewMethod.execute();yield this._boardView.refillByNewBlocks(this._refillByNewMethod.blocksData,o)})}},cc._RF.pop()},{}],BoardUI:[function(e,t,o){"use strict";cc._RF.push(t,"bdc4bG7FlhP37y/WpdIhdRQ","BoardUI");var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))(function(a,i){function r(e){try{n(s.next(e))}catch(t){i(t)}}function c(e){try{n(s.throw(e))}catch(t){i(t)}}function n(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(r,c)}n((s=s.apply(e,t||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0}),o.BoardUI=void 0;const a=e("game/GameStatus"),i=e("game/logic/blocks/BlockColorType"),r=e("game/logic/blocks/BlockSpecialType");o.BoardUI=class{constructor(e){this._boardViewImpl=e}fillWithInitialBlocks(e,t){return s(this,void 0,void 0,function*(){return this._clearAllBlocks(),this.refillByNewBlocks(e,t)})}refillByNewBlocks(e,t){return s(this,void 0,void 0,function*(){const o=[];for(const s of t){o.length&&(yield wait(Math.round(150*Math.random())));for(const[t,a]of s){o.length&&(yield wait(Math.round(50*Math.random())));const s=e.getDataAt(t,a);r.isSpecialBlock(s)?o.push(this._boardViewImpl.addSpecialBlockToPos(r.getSpecialBlockIndex(s),t,a)):o.push(this._boardViewImpl.addSimpleBlockToPos(i.getSimpleBlockIndex(s),t,a))}}yield Promise.all(o)})}collapseBlocks(e,t){return s(this,void 0,void 0,function*(){const o=[];for(const s of t){o.length&&(yield wait(200));for(const[t,a]of s)e.hasDataAt(t,a)||o.push(this._boardViewImpl.collapseBlockAtPos(t,a))}yield Promise.all(o)})}teleportBlocks(e){return s(this,void 0,void 0,function*(){const t=[];for(const o of e){t.length&&(yield wait(Math.round(50*Math.random())));for(let e=0;e<o.length;e+=2){const s=o[e],a=o[e+1];t.push(this._boardViewImpl.swipeBlocks(s,a))}}yield Promise.all(t)})}showScores(e,t){return s(this,void 0,void 0,function*(){const o=[];for(const s of t){o.length&&(yield wait(200));for(const[t,a]of s){const s=e.getDataAt(t,a);s&&o.push(this._boardViewImpl.addScoreInfoToPos(s[0],t,a,s[1]))}}yield Promise.all(o)})}fallDownBlocksToEmpty(e,t){return s(this,void 0,void 0,function*(){const o=[];for(let s=0;s<e.length;s++){o.length&&(yield wait(200));const a=e[s],i=t[s];for(let e=0;e<a.length;e++){const t=a[e],s=i[e];o.push(this._boardViewImpl.animateBlockToEmpty(t,s).then(()=>this._boardViewImpl.fallenDownBlockAtPos(...s)))}}return Promise.all(o).then()})}idleShakeBoardBlocks(e){return s(this,void 0,void 0,function*(){for(const t of e){for(const[e,o]of t)this._boardViewImpl.idleShakeBlock(e,o);yield wait(Math.round(250*Math.random()))}})}onStartTurn(){return this._boardViewImpl.enableInteraction(),Promise.resolve()}onBoostActivate(){return this._boardViewImpl.disableInteraction(),Promise.resolve()}onEndTurn(){return this._boardViewImpl.disableInteraction(),Promise.resolve()}onCompleteResult(){return Promise.resolve()}onGameProcessUpdate(e){switch(e.status){case a.GameStatus.READY:case a.GameStatus.CONTINUE:return Promise.resolve();case a.GameStatus.WIN_STATUS:case a.GameStatus.LOSE_STATUS:return this._boardViewImpl.disableInteraction(),Promise.resolve();default:assertNever(e.status)}}_clearAllBlocks(){this._boardViewImpl.clearGameField()}},cc._RF.pop()},{"game/GameStatus":void 0,"game/logic/blocks/BlockColorType":void 0,"game/logic/blocks/BlockSpecialType":void 0}],BoardUpdate:[function(e,t,o){"use strict";cc._RF.push(t,"58428v8s/dLx6YQNYnOfRvD","BoardUpdate"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoardUpdate=void 0;const s=e("game/state/game-flow-state"),a=e("game/state/GameFlowStateBase"),i=e("game/state/GameFlowStateID");o.BoardUpdate=class extends a.GameFlowStateBase{constructor(e,t,o,s,a){super(!1,e,t,o,s,a),this.stateId=i.GameplayStateID.BOARD_UPDATE}goPlayerTurn(){return this.transitToState(i.GameplayStateID.PLAYER_TURN,void 0)}goUpdateBoard(){return s.ignoreTransition()}},cc._RF.pop()},{"game/state/GameFlowStateBase":void 0,"game/state/GameFlowStateID":void 0,"game/state/game-flow-state":void 0}],Board:[function(e,t,o){"use strict";cc._RF.push(t,"3788dNrPKdOW4txEIXR8Cc+","Board");var s,a,i,r,c,n,l,d=this&&this.__decorate||function(e,t,o,s){var a,i=arguments.length,r=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,s);else for(var c=e.length-1;c>=0;c--)(a=e[c])&&(r=(i<3?a(r):i>3?a(t,o,r):a(t,o))||r);return i>3&&r&&Object.defineProperty(t,o,r),r},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))(function(a,i){function r(e){try{n(s.next(e))}catch(t){i(t)}}function c(e){try{n(s.throw(e))}catch(t){i(t)}}function n(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(r,c)}n((s=s.apply(e,t||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0}),o.Board=void 0;const h=e("@cc_prefabs/board/Block"),m=e("@cc_prefabs/board/BlocksSet"),_=e("@cc_prefabs/board/ScoreInfo"),v=e("@cc_prefabs/board/ScoresSet"),f=e("../../../../global-init");var y=cc._decorator.ccclass,g=cc._decorator.disallowMultiple,P=cc._decorator.property;let b=class extends cc.Component{constructor(){super(...arguments),this.rowsCount=0,this.columnsCount=0,this.blockSize=f.assertProp(this,"blockSize"),this.scoresContainer=cc.assertProp(this,!0,()=>this.scoresContainer),this.effectsContainer=cc.assertProp(this,!0,()=>this.effectsContainer),this.blocksContainer=cc.assertProp(this,!0,()=>this.blocksContainer),this.gameFieldContainer=cc.assertProp(this,!0,()=>this.gameFieldContainer),this.blocksPrefab=cc.assertProp(this,!0,()=>this.blocksPrefab),this.scoresPrefab=cc.assertProp(this,!0,()=>this.scoresPrefab),this._blocksMap=[],this._onTouchBlocksField=e=>{var t;const o=e.getLocation();null===(t=this.onGameFieldTouchCallback)||void 0===t||t.call(this,...this.getSectorPosFromWorldPoint(o))}}resetInEditor(){const e=this.node.getChildByName("gamefield");this.rowsCount||(this.rowsCount=e&&e.height>100?(e.height-100)/100:8),this.columnsCount||(this.columnsCount=e&&e.width>100?(e.width-100)/100:8),this.blockSize&&0!=this.blockSize.width&&0!=this.blockSize.height||(this.blockSize.width=100,this.blockSize.height=100)}onLoad(){this._blocksSet=cc.instantiate(this.blocksPrefab).getComponent(m.BlocksSet),this._scoresSet=cc.instantiate(this.scoresPrefab).getComponent(v.ScoresSet),this.gameFieldContainer.on(cc.Node.EventType.TOUCH_START,this._onTouchBlocksField)}onDestroy(){this._blocksMap.length=0}_getBlockAtMap(e,t){var o,s;return(o=this._blocksMap)[s=e-1]||(o[s]=[]),this._blocksMap[e-1][t-1]}_addBlockToMap(e,t,o){var s,a;(s=this._blocksMap)[a=t-1]||(s[a]=[]),this._blocksMap[t-1][o-1]=e}_removeBlockFromMap(e,t){if(!this._blocksMap[e-1])return;const o=this._blocksMap[e-1][t-1];return this._blocksMap[e-1][t-1]=void 0,o}get interactive(){var e;return!!(null===(e=this.gameFieldContainer.getComponent(cc.BlockInputEvents))||void 0===e?void 0:e.enabled)}enableInteraction(){this.gameFieldContainer.removeComponent(cc.BlockInputEvents)}disableInteraction(){this.gameFieldContainer.addComponent(cc.BlockInputEvents)}getSectorPosFromWorldPoint(e){const t=this.gameFieldContainer.convertToNodeSpaceAR(e);return this.getSectorPosFromLocalPoint(t)}getSectorPosFromLocalPoint(e){return[Math.max(1,Math.min(this.rowsCount,Math.ceil(e.y/this.blockSize.height))),Math.max(1,Math.min(this.columnsCount,Math.ceil(e.x/this.blockSize.width)))]}localPointFromSectorPos(e,t){return new cc.Vec2((t-1)*this.blockSize.width,(e-1)*this.blockSize.height)}worldPointFromSectorPos(e,t){const o=this.localPointFromSectorPos(e,t);return this.gameFieldContainer.convertToWorldSpace(o)}addSimpleBlockToPos(e,t,o){return this._createAndAddBlock(this._blocksSet.simpleBlocksList[e],t,o)}addSpecialBlockToPos(e,t,o){return this._createAndAddBlock(this._blocksSet.specialBlocksList[e],t,o)}addScoreInfoToPos(e,t,o,s){const a=s?this._scoresSet.specialBlocksScore:this._scoresSet.simpleBlocksScore,i=this._createAndAdd(a,t,o,this.scoresContainer,_.ScoreInfo);return i?(this._updateZIndex(i,t,o),i.show(e).then(()=>{this.scoresContainer.removeChild(i.node)})):Promise.resolve(void 0)}collapseBlockAtPos(e,t){return p(this,void 0,void 0,function*(){const o=this._removeBlockFromMap(e,t);if(!o)return Promise.resolve();yield o.startDisappearAnim(),this.blocksContainer.removeChild(o.node)})}animateBlockToEmpty(e,t){const[o,s]=e,a=this._removeBlockFromMap(o,s);if(!a)return Promise.resolve();const[i,r]=t,c=Math.max(Math.abs(o-i),Math.abs(s-r));return this._animateToEmpty(a,t,.1*c)}_animateToEmpty(e,t,o){const[s,a]=t;let i;this._addBlockToMap(e,s,a),this._updateZIndex(e,s,a);const r=new Promise(e=>{i=e}),c=this.localPointFromSectorPos(s,a);return cc.tween(e.node).to(o,{x:c.x,y:c.y},{easing:"sineIn"}).call(i).start(),r}fallenDownBlockAtPos(e,t){return p(this,void 0,void 0,function*(){const o=this._removeBlockFromMap(e,t);o&&(yield o.startFallenDowAnim(),this._addBlockToMap(o,e,t),this._updateZIndex(o,e,t))})}idleShakeBlock(e,t){const o=this._getBlockAtMap(e,t);null==o||o.playShakeAnim()}swipeBlocks(e,t){return p(this,void 0,void 0,function*(){const[o,s]=e,[a,i]=t,r=Math.max(Math.abs(o-a),Math.abs(s-i)),c=this._removeBlockFromMap(...e),n=this._removeBlockFromMap(...t);c&&n||console.error("NO BLOCk");const l=[];return l.push(this._animateToEmpty(c,t,.1*r).then(()=>{this.idleShakeBlock(...t)})),l.push(this._animateToEmpty(n,e,.1*r).then(()=>{this.idleShakeBlock(...e)})),Promise.all(l).then()})}clearGameField(){this._blocksMap.length=0,this.blocksContainer.removeAllChildren(!0),this.effectsContainer.removeAllChildren(!0),this.scoresContainer.removeAllChildren(!0)}_createAndAddBlock(e,t,o){const s=this._createAndAdd(e,t,o,this.blocksContainer,h.Block);return s?(this._addBlockToMap(s,t,o),this._updateZIndex(s,t,o),s.startAppearAnim()):Promise.resolve(void 0)}_createAndAdd(e,t,o,s,a){const i=cc.instantiate(e);return this._setPosToBlockNode(i,t,o),s.addChild(i),i.getComponent(a)}_updateZIndex(e,t,o){e&&e.node||console.error("ERROR"),e.node.zIndex=t*this.columnsCount+o}_setPosToBlockNode(e,t,o){const s=this.localPointFromSectorPos(t,o);e.x=s.x,e.y=s.y}};d([P({type:cc.Integer,tooltip:"Rows count of blocks field."}),u("design:type",Number)],b.prototype,"rowsCount",void 0),d([P({type:cc.Integer,tooltip:"Columns count of blocks field."}),u("design:type",Number)],b.prototype,"columnsCount",void 0),d([P({type:cc.Size,tooltip:"Size for single block sector at blocks field."}),u("design:type","function"==typeof(s="undefined"!=typeof cc&&cc.Size)?s:Object)],b.prototype,"blockSize",void 0),d([P({type:cc.Node,tooltip:"Container for display player`s turn result scores."}),u("design:type","function"==typeof(a="undefined"!=typeof cc&&cc.Node)?a:Object)],b.prototype,"scoresContainer",void 0),d([P({type:cc.Node,tooltip:"Container of animated effects of player`s result action."}),u("design:type","function"==typeof(i="undefined"!=typeof cc&&cc.Node)?i:Object)],b.prototype,"effectsContainer",void 0),d([P({type:cc.Node,tooltip:"Container for all blocks."}),u("design:type","function"==typeof(r="undefined"!=typeof cc&&cc.Node)?r:Object)],b.prototype,"blocksContainer",void 0),d([P({type:cc.Node,tooltip:"Container for listen touches."}),u("design:type","function"==typeof(c="undefined"!=typeof cc&&cc.Node)?c:Object)],b.prototype,"gameFieldContainer",void 0),d([P({type:cc.Prefab,tooltip:"A set for all blocks at game-field (include special)."}),u("design:type","function"==typeof(n="undefined"!=typeof cc&&cc.Prefab)?n:Object)],b.prototype,"blocksPrefab",void 0),d([P({type:cc.Prefab,tooltip:"A set for all score-infos for `scores`-container at game-field (include score-info for special blocks)."}),u("design:type","function"==typeof(l="undefined"!=typeof cc&&cc.Prefab)?l:Object)],b.prototype,"scoresPrefab",void 0),b=d([y,g],b),o.Board=b,cc._RF.pop()},{"../../../../global-init":"global-init","@cc_prefabs/board/Block":void 0,"@cc_prefabs/board/BlocksSet":void 0,"@cc_prefabs/board/ScoreInfo":void 0,"@cc_prefabs/board/ScoresSet":void 0}],BombActivator:[function(e,t,o){"use strict";cc._RF.push(t,"01660w+OVtMHLDn248Sha21","BombActivator"),Object.defineProperty(o,"__esModule",{value:!0}),o.BombActivator=void 0,o.BombActivator=class{constructor(e,t){this._waveRadius=e,this._includeDiagonals=t}activateBlocks(e,t,o){const s=[],a=[e],i=[],r=this._waveRadius||Math.max(t.rows,t.columns);for(let c=1;c<=r&&a.length;c++){const e=a.splice(0,a.length);for(const r of e){const e=t.getSectorsAround(r,this._includeDiagonals);for(const t of e){o(t)&&s.push(t);const[e,r]=t;i[e]||(i[e]=[]),i[e][r]||(a.push(t),i[e][r]=!0)}}}return s}},cc._RF.pop()},{}],BoostID:[function(e,t,o){"use strict";cc._RF.push(t,"2b618ncj3tHtojlcRCHgppz","BoostID"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameplayBoostID=void 0,o.GameplayBoostID={TELEPORT:"boost-teleport",BOMB:"boost-bomb"},cc._RF.pop()},{}],BoostUpdateGameField:[function(e,t,o){"use strict";cc._RF.push(t,"65ac5i6C6hAq6MtKZlvYfXj","BoostUpdateGameField");var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))(function(a,i){function r(e){try{n(s.next(e))}catch(t){i(t)}}function c(e){try{n(s.throw(e))}catch(t){i(t)}}function n(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(r,c)}n((s=s.apply(e,t||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0}),o.BoostUpdateGameField=void 0;const a=e("game/boosts/BoostID");o.BoostUpdateGameField=class{constructor(e,t,o,s){this._playerTurnResultProvider=o,this._boostId=e,this._boardView=t,this._updateBlocksMethod=s}perform(){return s(this,void 0,void 0,function*(){if(!this._boostId)return Promise.resolve(void 0);yield this._updateBlocksByBoost()})}_updateBlocksByBoost(){return s(this,void 0,void 0,function*(){const e=this._updateBlocksMethod.execute(),t=[];switch(this._boostId){case a.GameplayBoostID.TELEPORT:t.push(this._boardView.teleportBlocks(e));break;case a.GameplayBoostID.BOMB:t.push(this._boardView.collapseBlocks(this._updateBlocksMethod.blocksData,e));break;default:assertNever(this._boostId)}yield wait(250);const o=this._playerTurnResultProvider();t.push(this._boardView.showScores(...o.scoreBySectors)),yield Promise.all(t)})}},cc._RF.pop()},{"game/boosts/BoostID":void 0}],Boosters:[function(e,t,o){"use strict";cc._RF.push(t,"2c1e3Q0cb5LKIHCTH/0OLcW","Boosters");var s,a,i,r,c=this&&this.__decorate||function(e,t,o,s){var a,i=arguments.length,r=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,s);else for(var c=e.length-1;c>=0;c--)(a=e[c])&&(r=(i<3?a(r):i>3?a(t,o,r):a(t,o))||r);return i>3&&r&&Object.defineProperty(t,o,r),r},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(o,"__esModule",{value:!0}),o.Boosters=void 0;const l=e("@cc_platform/animation/CCSequentAnimationPlayer"),d=e("game/boosts/BoostID"),u=e("../../../../global-init"),{ccclass:p,property:h}=cc._decorator;let m=class extends cc.Component{constructor(){super(...arguments),this.boosterTeleport=u.assertProp(this,"boosterTeleport"),this.boosterTeleportCount=cc.assertProp(this,"boosterTeleportCount"),this.boosterBomb=cc.assertProp(this,"boosterBomb"),this.boosterBombCount=cc.assertProp(this,"boosterBombCount")}onLoad(){let e=this.boosterTeleport.getComponent(cc.Animation),t=0;this._activateTeleportAnimId=e.getClips()[t++].name,this._teleportAnimPlayer=new l.CCSequentAnimationPlayer(e),e=this.boosterBomb.getComponent(cc.Animation),t=0,this._activateBombAnimId=e.getClips()[t++].name,this._bombAnimPlayer=new l.CCSequentAnimationPlayer(e)}onBoostTeleportButtonClick(){var e;null===(e=this.onBoostTeleportCallback)||void 0===e||e.call(this)}onBoostBombButtonClick(){var e;null===(e=this.onBoostBombCallback)||void 0===e||e.call(this)}get interactive(){var e;return!!(null===(e=this.node.getComponent(cc.BlockInputEvents))||void 0===e?void 0:e.enabled)}enableInteraction(){this.node.removeComponent(cc.BlockInputEvents)}disableInteraction(){this.node.addComponent(cc.BlockInputEvents)}getReady(e){const t=Object.values(d.GameplayBoostID);for(const o of t)switch(o){case d.GameplayBoostID.TELEPORT:this.boosterTeleportCount.string=`${e.teleport}`,this.boosterTeleport.interactable=e.teleport>0;break;case d.GameplayBoostID.BOMB:this.boosterBombCount.string=`${e.bomb}`,this.boosterBomb.interactable=e.bomb>0;break;default:assertNever(o)}}updateBoosterCount(e,t){switch(e){case d.GameplayBoostID.TELEPORT:return t&&(this.boosterTeleport.interactable=!0),this._teleportAnimPlayer.start(this._activateTeleportAnimId).then(()=>{this.boosterTeleportCount.string=`${t}`,this.boosterTeleport.interactable=t>0}).catch(()=>{this.boosterTeleportCount.string=`${t}`,this.boosterTeleport.interactable=t>0});case d.GameplayBoostID.BOMB:return t&&(this.boosterBomb.interactable=!0),this._bombAnimPlayer.start(this._activateBombAnimId).then(()=>{this.boosterBombCount.string=`${t}`,this.boosterBomb.interactable=t>0}).catch(()=>{this.boosterBombCount.string=`${t}`,this.boosterBomb.interactable=t>0});default:assertNever(e)}}};c([h({type:cc.Button,tooltip:'Booster "teleport" button.'}),n("design:type","function"==typeof(s="undefined"!=typeof cc&&cc.Button)?s:Object)],m.prototype,"boosterTeleport",void 0),c([h({type:cc.Label,tooltip:'Booster "teleport" count label.'}),n("design:type","function"==typeof(a="undefined"!=typeof cc&&cc.Label)?a:Object)],m.prototype,"boosterTeleportCount",void 0),c([h({type:cc.Button,tooltip:'Booster "bomb" button.'}),n("design:type","function"==typeof(i="undefined"!=typeof cc&&cc.Button)?i:Object)],m.prototype,"boosterBomb",void 0),c([h({type:cc.Label,tooltip:'Booster "bomb" count label.'}),n("design:type","function"==typeof(r="undefined"!=typeof cc&&cc.Label)?r:Object)],m.prototype,"boosterBombCount",void 0),m=c([p],m),o.Boosters=m,cc._RF.pop()},{"../../../../global-init":"global-init","@cc_platform/animation/CCSequentAnimationPlayer":void 0,"game/boosts/BoostID":void 0}],BoostsUI:[function(e,t,o){"use strict";cc._RF.push(t,"0858cqNPTdLM62hcC3feK6n","BoostsUI"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoostsUI=void 0;const s=e("game/boosts/BoostID"),a=e("game/GameStatus");o.BoostsUI=class{constructor(e){this._boostsViewImpl=e}onStartTurn(){return this._boostsViewImpl.enableInteraction(),Promise.resolve()}onBoostActivate(e,t){let o=0;switch(e){case s.GameplayBoostID.TELEPORT:o=t.teleport;break;case s.GameplayBoostID.BOMB:o=t.bomb;break;default:assertNever(e)}return this._boostsViewImpl.updateBoosterCount(e,o),this._boostsViewImpl.disableInteraction(),Promise.resolve()}onEndTurn(){return this._boostsViewImpl.disableInteraction(),Promise.resolve()}onCompleteResult(e,t){const o=Object.values(s.GameplayBoostID);for(const a of o)switch(a){case s.GameplayBoostID.TELEPORT:e.reward.teleport&&this._boostsViewImpl.updateBoosterCount(a,t.boosters.teleport);break;case s.GameplayBoostID.BOMB:e.reward.bomb&&this._boostsViewImpl.updateBoosterCount(a,t.boosters.bomb);break;default:assertNever(a)}return Promise.resolve()}onGameProcessUpdate(e){switch(e.status){case a.GameStatus.READY:return this._boostsViewImpl.getReady(e.boosters),Promise.resolve();case a.GameStatus.CONTINUE:case a.GameStatus.WIN_STATUS:case a.GameStatus.LOSE_STATUS:return Promise.resolve();default:assertNever(e.status)}}},cc._RF.pop()},{"game/GameStatus":void 0,"game/boosts/BoostID":void 0}],CCAudioPlayer:[function(e,t,o){"use strict";cc._RF.push(t,"cc8fd7tv5pB4LrMT00/o7Pk","CCAudioPlayer"),Object.defineProperty(o,"__esModule",{value:!0}),o.CCAudioPlayer=void 0,o.CCAudioPlayer=class{constructor(e){this._paused=!1,this.name=e}get paused(){return this._paused}pause(){}resume(){}play(e,t){return console.log(e,t),!1}stop(e){return console.log(e),!1}setLoop(e,t){console.log(e,t)}setVolume(e,t){console.log(e,t)}mute(e){console.log(e)}unmute(e){console.log(e)}},cc._RF.pop()},{}],CCGameLoopUpdateAgent:[function(e,t,o){"use strict";cc._RF.push(t,"404e0ZM7LpJpINj4HJYDCwl","CCGameLoopUpdateAgent");var s=this&&this.__decorate||function(e,t,o,s){var a,i=arguments.length,r=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,s);else for(var c=e.length-1;c>=0;c--)(a=e[c])&&(r=(i<3?a(r):i>3?a(t,o,r):a(t,o))||r);return i>3&&r&&Object.defineProperty(t,o,r),r};Object.defineProperty(o,"__esModule",{value:!0}),o.CCGameLoopUpdateAgent=void 0;let a=class extends cc.Component{constructor(){super(...arguments),this._active=!1,this._frameReceiver=null}requestNextFrame(){this._active=!0}cancelRequestedFrame(){this._active=!1}setFrameReceiver(e){this._frameReceiver=e}update(e){var t;this._active&&(null===(t=this._frameReceiver)||void 0===t||t.call(this,e))}};a=s([cc._decorator.ccclass,cc._decorator.disallowMultiple],a),o.CCGameLoopUpdateAgent=a,cc._RF.pop()},{}],CCParallelAnimationPlayer:[function(e,t,o){"use strict";cc._RF.push(t,"14bbcIcc1NMDLikcr4kRM3X","CCParallelAnimationPlayer"),Object.defineProperty(o,"__esModule",{value:!0}),o.CCParallelAnimationPlayer=void 0,o.CCParallelAnimationPlayer=class{constructor(e){this._animationResolvers=new Map,this._onFinished=(e,t)=>{const o="string"==typeof e?t.name:e.name,s=this._animationResolvers.get(o);s&&(s.doResolve(),this._animationResolvers.delete(o))},this._ccAnimation=e,this._init()}_init(){this._ccAnimation.on(cc.Animation.EventType.FINISHED,this._onFinished)}start(e){const t=this._animationResolvers.get(e);if(t)return t.waiter;if(!this._ccAnimation.hasAnimationState(e))return Promise.reject(`Has no animation named '${e}'.`);let o;this._ccAnimation.playAdditive(e);const s=new Promise(e=>{o=e});return this._animationResolvers.set(e,{doResolve:o,waiter:s}),s}pause(){this._ccAnimation.pause()}resume(){this._ccAnimation.resume()}cancel(){this._animationResolvers.clear(),this._ccAnimation.stop()}destroy(){this.cancel(),this._ccAnimation.off(cc.Animation.EventType.FINISHED,this._onFinished)}},cc._RF.pop()},{}],CCSequentAnimationPlayer:[function(e,t,o){"use strict";cc._RF.push(t,"de65dUKu/FKfa7mlmP49/SM","CCSequentAnimationPlayer"),Object.defineProperty(o,"__esModule",{value:!0}),o.CCSequentAnimationPlayer=void 0,o.CCSequentAnimationPlayer=class{constructor(e){this._onFinished=()=>{var e;this._animationResolver&&(null===(e=this._animationResolver)||void 0===e||e.doResolve(),this._animationResolver=this._animationResolver.next,this._animationResolver&&this._ccAnimation.play(this._animationResolver.animationId))},this._ccAnimation=e,this._init()}_init(){this._ccAnimation.on(cc.Animation.EventType.FINISHED,this._onFinished)}start(e){const t=this._getFinalAnimationResolver(e,this._animationResolver);if(t){if(t.animationId==e)return t.waiter;let o;const s=new Promise(e=>{o=e});return t.next={animationId:e,doResolve:o,waiter:s},t.next.waiter}if(!this._ccAnimation.hasAnimationState(e))return Promise.reject(`Has no animation named '${e}'.`);let o;this._ccAnimation.play(e);const s=new Promise(e=>{o=e});return this._animationResolver={animationId:e,doResolve:o,waiter:s},s}pause(){this._ccAnimation.pause()}resume(){this._ccAnimation.resume()}cancel(){delete this._animationResolver,this._ccAnimation.stop()}destroy(){this.cancel(),this._ccAnimation.off(cc.Animation.EventType.FINISHED,this._onFinished)}_getFinalAnimationResolver(e,t){return(null==t?void 0:t.animationId)==e?t:(null==t?void 0:t.next)?this._getFinalAnimationResolver(e,t.next):t}},cc._RF.pop()},{}],CancelAllActiveActions:[function(e,t,o){"use strict";cc._RF.push(t,"c679fwKlddGVaydRIn1vX1a","CancelAllActiveActions"),Object.defineProperty(o,"__esModule",{value:!0}),o.CancelAllActiveActions=void 0,o.CancelAllActiveActions=class{constructor(e,t,o){this._actionManager=e,this._withComplete=t,this._releaseActionManager=o}perform(){var e;return this._actionManager.cancelAll(this._withComplete),null===(e=this._releaseActionManager)||void 0===e||e.call(this),Promise.resolve()}},cc._RF.pop()},{}],CancelAllActiveAnimations:[function(e,t,o){"use strict";cc._RF.push(t,"c46dfg2Dt5Graf1p55nK7Sx","CancelAllActiveAnimations"),Object.defineProperty(o,"__esModule",{value:!0}),o.CancelAllActiveAnimations=void 0,o.CancelAllActiveAnimations=class{constructor(e,t){this._animationManager=e,this._withComplete=t}perform(){return this._animationManager.cancelAll(this._withComplete),Promise.resolve()}},cc._RF.pop()},{}],CounterAction:[function(e,t,o){"use strict";cc._RF.push(t,"acb21KGTx1AZrS+jtR1YweT","CounterAction"),Object.defineProperty(o,"__esModule",{value:!0}),o.CounterAction=void 0;const s=e("core/systems/action/Action"),a=e("core/systems/action/ease/easings");o.CounterAction=class extends s.Action{constructor(e,t,o,s){super(),this._elapsedTimeSec=0,this._currValue=e,this._startValue=e,this._endValue=t,this._durationSec=o,this._process=s||a.LineInOut}get progress(){return this._durationSec<=0?1:Math.min(1,this._elapsedTimeSec/this._durationSec)}get value(){return this._currValue}doUpdate(e){this._elapsedTimeSec+=e/1e3,this._currValue=this._process(this._startValue,this._endValue,this.progress)}checkIsCompleteAfterUpdate(){return this._durationSec<=0||this._endValue-this._currValue<=0}},cc._RF.pop()},{"core/systems/action/Action":void 0,"core/systems/action/ease/easings":void 0}],DelayAction:[function(e,t,o){"use strict";cc._RF.push(t,"562a0cq0DVA06BYtKklvnNY","DelayAction"),Object.defineProperty(o,"__esModule",{value:!0}),o.DelayAction=void 0;const s=e("core/systems/action/Action");o.DelayAction=class extends s.Action{constructor(e,t=""){super(t),this._elapsedMs=0,this.delayMs=e}get progress(){return this.delayMs?Math.max(0,Math.min(1,this._elapsedMs/this.delayMs)):1}get elapsedTime(){return Math.min(this.delayMs,this._elapsedMs)}doUpdate(e){this._elapsedMs+=e}checkIsCompleteAfterUpdate(){return this._elapsedMs>=this.delayMs}},cc._RF.pop()},{"core/systems/action/Action":void 0}],DelayOutLoopAction:[function(e,t,o){"use strict";cc._RF.push(t,"c8ad5pBwWVFHaumBIBrZdOr","DelayOutLoopAction"),Object.defineProperty(o,"__esModule",{value:!0}),o.DelayOutLoopAction=void 0;const s=e("core/systems/action/Action");o.DelayOutLoopAction=class extends s.Action{constructor(e,t=""){super(t),this._timer=0,this._startTimeStamp=0,this._onTimeout=()=>{this._stopTimer(),this.completed||this.canceled||(this.completed=!0)},this.delayMs=e}get progress(){return this.delayMs?this._startTimeStamp?Math.max(0,Math.min(1,(Date.now()-this._startTimeStamp)/this.delayMs)):0:1}get elapsedTime(){return this._startTimeStamp?Math.min(this.delayMs,Date.now()-this._startTimeStamp):0}doCancel(){this._stopTimer()}_launchTimer(e){this._startTimeStamp=Date.now(),this._timer=setTimeout(this._onTimeout,e)}_stopTimer(){this._timer&&clearTimeout(this._timer),this._timer=0}doUpdate(e){this._timer||this._launchTimer(Math.max(this.delayMs-e))}checkIsCompleteAfterUpdate(){return this.completed}},cc._RF.pop()},{"core/systems/action/Action":void 0}],EventBus:[function(e,t,o){"use strict";cc._RF.push(t,"18b88wJEBZPh5mPEM6tcnl6","EventBus"),Object.defineProperty(o,"__esModule",{value:!0}),o.EventBus=void 0;const s=e("core/gameloop/GameLoopPhase");o.EventBus=class{constructor(){this.updatePhase=s.GameLoopPhase.LOGIC,this._listeners=new Map,this._queue=[]}on(e,t){let o=this._listeners.get(e);return o||(o=new Set,this._listeners.set(e,o)),o.add(t),()=>{o.delete(t),0===o.size&&this._listeners.delete(e)}}once(e,t){const o=this.on(e,e=>{o(),t(e)});return o}off(e,t){const o=this._listeners.get(e);o&&(o.delete(t),0===o.size&&this._listeners.delete(e))}emitImmediately(e,t){const o=this._listeners.get(e);if(o)for(const s of[...o])s(t)}emit(e,t){const o=Promise.resolve();return this._queue.push([e,t]),o}clear(){this._listeners.clear(),this._queue.length=0}update(){const e=[...this._queue];this._queue.length=0;for(const[t,o]of e)this.emitImmediately(t,o)}},cc._RF.pop()},{"core/gameloop/GameLoopPhase":void 0}],EventID:[function(e,t,o){"use strict";cc._RF.push(t,"c16e2zpSf5KlKaP2DQWkt00","EventID"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameplayEventID=void 0,o.GameplayEventID={NEXT_TURN:"player-next",REFILL_BOARD:"board-refill",PLAYER_WON:"player-won",PLAYER_LOST:"player-lost",GAME_END:"game-end"},cc._RF.pop()},{}],FallDownFromBlocksMethod:[function(e,t,o){"use strict";cc._RF.push(t,"0715dG7BEpB9ZJbNdjPSdL/","FallDownFromBlocksMethod"),Object.defineProperty(o,"__esModule",{value:!0}),o.FallDownFromBlocksMethod=void 0,o.FallDownFromBlocksMethod=class{constructor(e){this._fieldProvider=e}get blocksData(){return this._fieldProvider()}execute(){const e=[],t=this._fieldProvider();for(let o=1;o<=t.columns;o++){let s=!1,a=-1;for(let i=1;i<=t.rows;i++)t.hasDataAt(i,o)?((s||a>=0)&&(s||a++,e[a=Math.max(0,a)]||(e[a]=[]),e[a].push([i,o])),s=!1):s=!0}return e}},cc._RF.pop()},{}],FallDownToBlocksMethod:[function(e,t,o){"use strict";cc._RF.push(t,"b74371aQsdApYing4dV8cHY","FallDownToBlocksMethod"),Object.defineProperty(o,"__esModule",{value:!0}),o.FallDownToBlocksMethod=void 0;const s=e("game/logic/blocks/BlocksField");o.FallDownToBlocksMethod=class{constructor(e,t,o){this._fieldProvider=e,this._fieldEditor=t,this._fallFromMethod=o}get blocksData(){return this._fieldProvider()}execute(){const e=this._fallFromMethod.execute(),t=[];for(let o=0;o<e.length;o++){const a=e[o];t[o]||(t[o]=[]);for(let e=0;e<a.length;e++){const[i,r]=a[e],c=this._fieldProvider(),n=[i-1,r];for(let e=n[0];e>=1&&!c.hasDataAt(e,r);e--)n[0]=e;t[o][e]=n;const l=c.getDataAt(i,r);s.isBlockTypeData(l)&&(this._fieldEditor.removeData(i,r),this._fieldEditor.setDataAt(n,l))}}return t}},cc._RF.pop()},{"game/logic/blocks/BlocksField":void 0}],FieldDataIterable:[function(e,t,o){"use strict";cc._RF.push(t,"42159LlbBxMFqRCeB8XPbHF","FieldDataIterable"),Object.defineProperty(o,"__esModule",{value:!0}),o.FieldDataIterable=void 0,o.FieldDataIterable=class{constructor(e){this._fieldData=e}[Symbol.iterator](){const e=this._fieldData.rows,t=this._fieldData.columns,o=e*t,s=()=>(a-1)*t+i;let a=1,i=1;const r=(e,t)=>this._fieldData.getDataAt(e,t);return{next:()=>(i>t&&(i=1,a++),s()>o?{done:!0,value:void 0}:{done:!1,value:[r(a,i),[a,i++]]})}}},cc._RF.pop()},{}],FieldData:[function(e,t,o){"use strict";cc._RF.push(t,"72af9hd4YFKTrOgf7JCpCNc","FieldData"),Object.defineProperty(o,"__esModule",{value:!0}),o.FieldData=void 0;const s=e("game/logic/field/FieldDataIterable");o.FieldData=class{constructor(e,t,o,a){this._emptySectorValue=o,this.rows=0|e,this.columns=0|t,this._raw=Array(this.rows).fill(this._emptySectorValue).map(()=>Array(this.columns).fill(this._emptySectorValue)),this._iterationAgent=a||new s.FieldDataIterable(this)}get raw(){return this._raw}get sectors(){return Array(this.rows*this.columns).fill(this._emptySectorValue).map((e,t)=>{const o=Math.ceil((t+1)/this.columns);return[o,t+1-(o-1)*this.columns]})}get data(){return this._iterationAgent}clear(){for(const[e,[t,o]]of this.data)e!==this._emptySectorValue&&this._setRawData(t,o,this._emptySectorValue)}removeData(e,t){const[o,s]=this._resolvePos(e,t);return this._getRawData(o,s)!=this._emptySectorValue&&(this._setRawData(o,s,this._emptySectorValue),!0)}setDataAt(e,t,o){let[s,a]=[0,0];void 0===o?(o=t,[s,a]=this._resolvePos(e)):[s,a]=this._resolvePos(e,t),this._setRawData(s,a,o)}hasDataAt(e,t){const[o,s]=this._resolvePos(e,t);return this._getRawData(o,s)!=this._emptySectorValue}getDataAt(e,t){const[o,s]=this._resolvePos(e,t);return this._getRawData(o,s)}getSectorsAround(e,t,o){let s,a;"boolean"==typeof t?(o=t,[s,a]=this._resolvePos(e)):[s,a]=this._resolvePos(e,t);const i=[];let r=0;return s>1&&(i[r++]=[s-1,a]),s<this.rows&&(i[r++]=[s+1,a]),a>1&&(i[r++]=[s,a-1]),a<this.columns&&(i[r++]=[s,a+1]),o&&(s>1&&a>1&&(i[r++]=[s-1,a-1]),s>1&&a<this.columns&&(i[r++]=[s-1,a+1]),s<this.rows&&a<this.columns&&(i[r++]=[s+1,a+1]),s<this.rows&&a>1&&(i[r++]=[s+1,a-1])),i}_resolvePos(e,t){return"number"==typeof e?[e,t]:e}_getRawData(e,t){return this._raw[e-1][t-1]}_setRawData(e,t,o){this._raw[e-1][t-1]=o}},cc._RF.pop()},{"game/logic/field/FieldDataIterable":void 0}],FillFullBoardMethod:[function(e,t,o){"use strict";cc._RF.push(t,"302c0BTFypCq5mmPVlNRTUF","FillFullBoardMethod"),Object.defineProperty(o,"__esModule",{value:!0}),o.FillFullBoardMethod=void 0,o.FillFullBoardMethod=class{constructor(e,t,o){this._fieldProvider=e,this._fieldEditor=t,this._refillMethod=o}get blocksData(){return this._fieldProvider()}execute(){return this._fieldEditor.clear(),this._refillMethod.execute()}},cc._RF.pop()},{}],GameFlowControl:[function(e,t,o){"use strict";cc._RF.push(t,"a9618+G1w5GsZ/Wx9CmQdXD","GameFlowControl");var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))(function(a,i){function r(e){try{n(s.next(e))}catch(t){i(t)}}function c(e){try{n(s.throw(e))}catch(t){i(t)}}function n(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(r,c)}n((s=s.apply(e,t||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0}),o.GameFlowControl=void 0;const a=e("game/boosts/BoostID"),i=e("game/event/EventID");o.GameFlowControl=class{constructor(e,t,o){this._inTransition=!1,this._onTouchBlocksField=(e,t)=>{var o,s;console.log(`[GameControl::_onTouchBlocksField] touch ${e}-row and ${t}-column.`),console.log(`[GameControl::_onTouchBlocksField] ${null===(o=this._currState)||void 0===o?void 0:o.stateId}`),this._handleIfTransitionError(null===(s=this._currState)||void 0===s?void 0:s.goPlayerResult([e,t]))},this._onRefillBoard=()=>{var e;this._handleIfTransitionError(null===(e=this._currState)||void 0===e?void 0:e.goUpdateBoard())},this._onNextTurn=()=>{var e;console.log("[GameControl::_onNextTurn]"),this._handleIfTransitionError(null===(e=this._currState)||void 0===e?void 0:e.goPlayerTurn())},this._onPlayerWon=()=>{var e;this._handleIfTransitionError(null===(e=this._currState)||void 0===e?void 0:e.goPlayerWin())},this._onPlayerLost=()=>{var e;this._handleIfTransitionError(null===(e=this._currState)||void 0===e?void 0:e.goPlayerLose())},this._gameFieldInteractive=e,this._boostersInteractive=t,this._gameEventDispatcher=o}_init(){this._gameFieldInteractive.onGameFieldTouchCallback=this._onTouchBlocksField,this._boostersInteractive.onBoostTeleportCallback=()=>this._onBoostClick(a.GameplayBoostID.TELEPORT),this._boostersInteractive.onBoostBombCallback=()=>this._onBoostClick(a.GameplayBoostID.BOMB),this._gameEventDispatcher.on(i.GameplayEventID.REFILL_BOARD,this._onRefillBoard),this._gameEventDispatcher.on(i.GameplayEventID.NEXT_TURN,this._onNextTurn),this._gameEventDispatcher.on(i.GameplayEventID.PLAYER_WON,this._onPlayerWon),this._gameEventDispatcher.on(i.GameplayEventID.PLAYER_LOST,this._onPlayerLost)}start(e){return s(this,void 0,void 0,function*(){this._init(),yield this.changeState(e)})}changeState(e){var t,o;return s(this,void 0,void 0,function*(){if(this._inTransition&&!(null===(t=this._currState)||void 0===t?void 0:t.canInterrupt))return Promise.reject();console.log(`[GameControl] Start transition to '${e.stateId}' state:`),this._inTransition=!0,yield null===(o=this._currState)||void 0===o?void 0:o.exit(),this._currState=e,yield this._currState.enter(),this._inTransition=!1,console.log(`[GameControl] Transition to '${e.stateId}' state completed!`)})}_onBoostClick(e){var t;this._handleIfTransitionError(null===(t=this._currState)||void 0===t?void 0:t.goBoostUsage(e))}_handleIfTransitionError(e){e&&e.catch(e=>{console.warn(e)})}},cc._RF.pop()},{"game/boosts/BoostID":void 0,"game/event/EventID":void 0}],GameFlowStateBase:[function(e,t,o){"use strict";cc._RF.push(t,"1d6c565NgJOV5+RW6OTElw7","GameFlowStateBase");var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))(function(a,i){function r(e){try{n(s.next(e))}catch(t){i(t)}}function c(e){try{n(s.throw(e))}catch(t){i(t)}}function n(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(r,c)}n((s=s.apply(e,t||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0}),o.GameFlowStateBase=void 0;const a=e("./game-flow-state");o.GameFlowStateBase=class{constructor(e,t,o,s=[],a=[],i){this._exiting=!1,this._guards=i,this._canInterrupt=e,this._enterStrategies=s,this._exitStrategies=a,this._context=t,this._factory=o}get canInterrupt(){return!this._exiting&&this._canInterrupt}exit(){return s(this,void 0,void 0,function*(){this._exiting=!0;for(const e of this._exitStrategies)yield e.perform();this._exiting=!1})}enter(){return s(this,void 0,void 0,function*(){for(const e of this._enterStrategies)yield e.perform()})}goReadyBoard(){return a.transitionBlockedResult()}goPlayerTurn(){return a.transitionBlockedResult()}goBoostUsage(e){return a.transitionBlockedResult(e)}goPlayerResult(e){return a.transitionBlockedResult(e)}goPlayerWin(){return a.transitionBlockedResult()}goPlayerLose(){return a.transitionBlockedResult()}goUpdateBoard(){return a.transitionBlockedResult()}transitToState(e,t){if(this._guards&&!this._guards[e].canTransit(t))return Promise.resolve();const o=this._factory.getState(e,t);return this._context.changeState(o)}},cc._RF.pop()},{"./game-flow-state":"game-flow-state"}],GameFlowStateID:[function(e,t,o){"use strict";cc._RF.push(t,"d70663+7PRP6ohB0xdjsqEW","GameFlowStateID"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameplayStateID=void 0,o.GameplayStateID={BOARD_READY:"ready_board",PLAYER_TURN:"player_turn",PLAYER_BOOST:"player_use_boost",PLAYER_RESULT:"player_result",PLAYER_WIN:"player_win",PLAYER_LOSE:"player_lose",BOARD_UPDATE:"update_board"},cc._RF.pop()},{}],GameLoopPhase:[function(e,t,o){"use strict";cc._RF.push(t,"8ec4dpbqldCmq3S+Jh0Lc/s","GameLoopPhase"),Object.defineProperty(o,"__esModule",{value:!0}),o.OrderedGameLoopPhases=o.GameLoopPhase=void 0,o.GameLoopPhase={INPUT:0,LOGIC:1,ANIMATION:2,AUDIO:3,VIEW:4},o.OrderedGameLoopPhases=Object.values(o.GameLoopPhase),cc._RF.pop()},{}],GameLoop:[function(e,t,o){"use strict";cc._RF.push(t,"be5d2vfPL1OMoCz3SZq6z3L","GameLoop"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameLoop=void 0;const s=e("core/gameloop/GameLoopPhase"),a=e("core/gameloop/GameTime");o.GameLoop=class{constructor(){this.name="GameLoop-Cycle-System-Manager",this._running=!1,this._lastTotalTime=0,this._updatableSystems=new Map,this._ignoreRenderPhase=!1,this._paused=!1,this._onNextFrame=e=>{this._running&&(this._tick(this._lastTotalTime>0?e-this._lastTotalTime:0),this._lastTotalTime=e,this._requestNextFrame())},this._gameTime=new a.GameTime(1e3)}get paused(){return this._paused}init(e){this._renderMethod=e}start(e,t=!1){this._running||(this._running=!0,this._frameRequester=e,this._frameRequester.setFrameReceiver(this._onNextFrame),this._frameRequester.requestNextFrame(!1),this._ignoreRenderPhase=t)}stop(){this._running&&(this._running=!1,this._frameRequester&&(this._frameRequester.setFrameReceiver(null),this._frameRequester.cancelRequestedFrame()))}pause(){this._paused=!0}resume(){this._paused=!1}setTimeScale(e=1){this._gameTime.setScale(e)}add(e){let t=this._updatableSystems.get(e.updatePhase);t||(t=[],this._updatableSystems.set(e.updatePhase,t)),t.push(e)}remove(e){const t=this._updatableSystems.get(e.updatePhase);if(!t)return;const o=t.lastIndexOf(e);o>=0&&t.splice(o,1)}_requestNextFrame(){var e;null===(e=this._frameRequester)||void 0===e||e.requestNextFrame(!0)}_tick(e){var t,o;if(this._gameTime.addDeltaTime(e),!this._paused){for(const e of s.OrderedGameLoopPhases){const o=this._updatableSystems.get(e);if(o)for(const e of o)null===(t=e.update)||void 0===t||t.call(e,this._gameTime.deltaTimeMs)}this._ignoreRenderPhase||null===(o=this._renderMethod)||void 0===o||o.call(this)}}},cc._RF.pop()},{"core/gameloop/GameLoopPhase":void 0,"core/gameloop/GameTime":void 0}],GameProcessMapper:[function(e,t,o){"use strict";cc._RF.push(t,"fc94d+KPSlOv6WFCI5yLSrh","GameProcessMapper"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameProcessMapper=void 0;const s=e("game/logic/blocks/BlocksField"),a=/^(?<Row>\d+)-(?<Column>\d+):(?<Type>.+)$/;o.GameProcessMapper=class{serialize(e,t){const o={version:"1.0",board_data:e.sectors.map(([t,o])=>`${t}-${o}:${e.getDataAt(t,o)}`),game_process:{status:t.status,total_score:t.totalScore,score_to_win:t.scoreToWin,turns_completed:t.turnsCompleted,turns_left:t.turnsLeft,boosters_count:{teleport:t.boosters.teleport,bomb:t.boosters.bomb}}};return JSON.stringify(o)}deserialize(e,t,o){"string"==typeof e&&(e=JSON.parse(e)),this._getDeserializer(e.version)(e,t,o)}_getDeserializer(e){return console.log(e),(e,t,o)=>{t.clear();for(const i of e.board_data){const e=i.match(a);if(e){const o=parseInt(e[1],10),a=parseInt(e[2],10),i=parseInt(e[3],10);s.isBlockTypeData(i)&&t.setDataAt(o,a,i)}}o.setStatus(e.game_process.status)}}},cc._RF.pop()},{"game/logic/blocks/BlocksField":void 0}],GameProcessModel:[function(e,t,o){"use strict";cc._RF.push(t,"93215JQxYdHxLrSRxGp4JII","GameProcessModel"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameProcessModel=void 0;const s=e("game/boosts/BoostID"),a=e("game/GameStatus");o.GameProcessModel=class{constructor(e){this._status=a.GameStatus.READY,this._totalScore=0,this._turnsCompleted=0,this._levelSettings=e,this._turnsLeft=this._levelSettings.process.start.startTurnsCount,this.boosters=Object.assign({},this._levelSettings.process.start.startBoosters)}get status(){return this._status}get totalScore(){return this._totalScore}get scoreToWin(){return this._levelSettings.process.scoreToWin}get turnsCompleted(){return this._turnsCompleted}get turnsLeft(){return this._turnsLeft}enterBooster(e){switch(e){case s.GameplayBoostID.TELEPORT:this.boosters.teleport=Math.max(0,this.boosters.teleport-1);break;case s.GameplayBoostID.BOMB:this.boosters.bomb=Math.max(0,this.boosters.bomb-1);break;default:assertNever(e)}}setStatus(e){switch(this._status){case a.GameStatus.READY:case a.GameStatus.CONTINUE:this._status=e;break;case a.GameStatus.WIN_STATUS:case a.GameStatus.LOSE_STATUS:break;default:assertNever(this._status)}}onStartTurn(){return Promise.resolve()}onBoostActivate(){return Promise.resolve()}onEndTurn(){return this._turnsCompleted++,this._turnsLeft=Math.max(0,this._turnsLeft-1),Promise.resolve()}onCompleteResult(e){return this.boosters.teleport+=e.reward.teleport,this.boosters.bomb+=e.reward.bomb,this._totalScore+=e.score,Promise.resolve()}},cc._RF.pop()},{"game/GameStatus":void 0,"game/boosts/BoostID":void 0}],GameResolveStatus:[function(e,t,o){"use strict";cc._RF.push(t,"0d878VJcdlMCZgcWMdkISkD","GameResolveStatus");var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))(function(a,i){function r(e){try{n(s.next(e))}catch(t){i(t)}}function c(e){try{n(s.throw(e))}catch(t){i(t)}}function n(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(r,c)}n((s=s.apply(e,t||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0}),o.GameResolveStatus=void 0,o.GameResolveStatus=class{constructor(e,t,o,s){this._gameProcessResultProvider=e,this._gameProcessAgent=t,this._gameProcessResolver=o,this._gameProcessObserversOrdered=s}perform(){return s(this,void 0,void 0,function*(){const e=this._gameProcessResolver.resolve(this._gameProcessResultProvider());this._gameProcessAgent.setStatus(e);for(const t of this._gameProcessObserversOrdered)yield t.onGameProcessUpdate(this._gameProcessResultProvider())})}},cc._RF.pop()},{}],GameResultResolver:[function(e,t,o){"use strict";cc._RF.push(t,"46cc0NbAGJPlJZow+kC4Jsq","GameResultResolver"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameResultResolver=void 0;const s=e("game/GameStatus");o.GameResultResolver=class{constructor(){}resolve(e){return e.totalScore>=e.scoreToWin?s.GameStatus.WIN_STATUS:e.turnsLeft<=0?s.GameStatus.LOSE_STATUS:s.GameStatus.CONTINUE}},cc._RF.pop()},{"game/GameStatus":void 0}],GameStatus:[function(e,t,o){"use strict";cc._RF.push(t,"9ed5fpOSYBL1bGRZwis61ry","GameStatus"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameStatus=void 0,o.GameStatus={READY:0,CONTINUE:1,WIN_STATUS:2,LOSE_STATUS:3},cc._RF.pop()},{}],GameTime:[function(e,t,o){"use strict";cc._RF.push(t,"65411HLmKVMY6wASf6rMafP","GameTime"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameTime=void 0,o.GameTime=class{constructor(e=0){this._elapsedTime=0,this._scaledElapsedTime=0,this._lastDeltaTime=0,this._scaledLastDeltaTime=0,this._timeScale=1,this._maxDeltaTimeThreshold=0,this._maxDeltaTimeThreshold=e>0?e:0}get totalTimeMs(){return this._scaledElapsedTime}get originTotalTimeMs(){return this._elapsedTime}get deltaTimeMs(){return this._scaledLastDeltaTime}get originDeltaTimeMs(){return this._lastDeltaTime}setScale(e=1){this._timeScale=Math.max(0,e)}addDeltaTime(e){this._lastDeltaTime=this._maxDeltaTimeThreshold>0?Math.min(e,this._maxDeltaTimeThreshold):e,this._elapsedTime+=this._lastDeltaTime,this._scaledLastDeltaTime=this._lastDeltaTime*this._timeScale,this._scaledElapsedTime+=this._scaledLastDeltaTime}},cc._RF.pop()},{}],HudUI:[function(e,t,o){"use strict";cc._RF.push(t,"3b475pP0O5ETJl4kbxxsfFY","HudUI"),Object.defineProperty(o,"__esModule",{value:!0}),o.HudUI=void 0;const s=e("game/GameStatus");o.HudUI=class{constructor(e){this._hudViewImpl=e}onStartTurn(){return Promise.resolve()}onBoostActivate(){return Promise.resolve()}onEndTurn(e,t){return this._hudViewImpl.turnCountUpdate(t),Promise.resolve()}onCompleteResult(e,t){return this._hudViewImpl.scoreCountUpdate(t.totalScore)}onGameProcessUpdate(e){switch(e.status){case s.GameStatus.READY:return this._hudViewImpl.getReady(e.turnsLeft,e.scoreToWin),Promise.resolve();case s.GameStatus.CONTINUE:case s.GameStatus.WIN_STATUS:case s.GameStatus.LOSE_STATUS:return this._hudViewImpl.gameStatusUpdate(e.status),Promise.resolve();default:assertNever(e.status)}}},cc._RF.pop()},{"game/GameStatus":void 0}],Hud:[function(e,t,o){"use strict";cc._RF.push(t,"f7de1rrs5xAM6Hk7wlhKeZJ","Hud");var s,a,i,r,c=this&&this.__decorate||function(e,t,o,s){var a,i=arguments.length,r=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,s);else for(var c=e.length-1;c>=0;c--)(a=e[c])&&(r=(i<3?a(r):i>3?a(t,o,r):a(t,o))||r);return i>3&&r&&Object.defineProperty(t,o,r),r},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))(function(a,i){function r(e){try{n(s.next(e))}catch(t){i(t)}}function c(e){try{n(s.throw(e))}catch(t){i(t)}}function n(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(r,c)}n((s=s.apply(e,t||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0}),o.Hud=void 0;const d=e("../../../../global-init"),u=e("@cc_components/hud/TurnsCounter"),p=e("@cc_platform/animation/CCParallelAnimationPlayer"),h=e("game/GameStatus");var m=cc._decorator.ccclass,_=cc._decorator.disallowMultiple,v=cc._decorator.property;let f=class extends cc.Component{constructor(){super(...arguments),this.turnsCounter=d.assertProp(this,!0,()=>this.turnsCounter),this.turnsCountLabel=cc.assertProp(this,!0,()=>this.turnsCountLabel),this.scorePanel=d.assertProp(this,!0,()=>this.scorePanel),this.scoreCountLabel=cc.assertProp(this,!0,()=>this.scoreCountLabel),this._turnsCount=0,this._currScore=0,this._scoreToWin=0}onLoad(){let e=this.turnsCounter.getComponent(cc.Animation),t=0;this._decreaseTurnsCountAnimId=e.getClips()[t++].name,this._turnsCounterLoseAnimId=e.getClips()[t++].name,this._turnsCounterWinAnimId=e.getClips()[t++].name,this._turnsCounterPlayer=new p.CCParallelAnimationPlayer(e),this._turnCounterComponent=this.turnsCounter.getComponent(u.TurnsCounter),t=0,e=this.scorePanel.getComponent(cc.Animation),this._increaseScoreCountAnimId=e.getClips()[t++].name,this._scoreCounterLoseAnimId=e.getClips()[t++].name,this._scoreCounterWinAnimId=e.getClips()[t++].name,this._scoreCounterPlayer=new p.CCParallelAnimationPlayer(e),this.scoreCountLabel.overflow=cc.Label.Overflow.SHRINK,this.getReady(0,0)}onDestroy(){delete this._turnCounterComponent.onAnimPeak}getReady(e,t){e|=0,this._turnsCount=e,this._currScore=0,this._scoreToWin=Math.round(1*t)/1,this.turnsCountLabel.string=`${e}`,this.scoreCountLabel.string=`0/${this._scoreToWin}`}turnCountUpdate(e){return l(this,void 0,void 0,function*(){e|=0,this._turnsCount!=e&&(this._turnsCount=e,yield this._turnsCounterPlayer.start(this._decreaseTurnsCountAnimId),this._turnCounterComponent.onAnimPeak=()=>{this.turnsCountLabel.string=`${this._turnsCount}`})})}scoreCountUpdate(e,t){return l(this,void 0,void 0,function*(){e=Math.round(1*e)/1,t||(t=this._scoreToWin),t=Math.round(1*t)/1,this._currScore!=e&&(this._currScore=e,this._scoreToWin=t,yield this._scoreCounterPlayer.start(this._increaseScoreCountAnimId),this.scoreCountLabel.string=`${this._currScore}/${this._scoreToWin}`)})}gameStatusUpdate(e){switch(e){case h.GameStatus.LOSE_STATUS:return Promise.all([this._turnsCounterPlayer.start(this._turnsCounterLoseAnimId),this._scoreCounterPlayer.start(this._scoreCounterLoseAnimId)]).then();case h.GameStatus.WIN_STATUS:return Promise.all([this._turnsCounterPlayer.start(this._turnsCounterWinAnimId),this._scoreCounterPlayer.start(this._scoreCounterWinAnimId)]).then();case h.GameStatus.READY:case h.GameStatus.CONTINUE:return Promise.resolve();default:assertNever(e)}}};c([v({type:cc.Node,tooltip:"Turns counter block with decrease animation."}),n("design:type","function"==typeof(s="undefined"!=typeof cc&&cc.Node)?s:Object)],f.prototype,"turnsCounter",void 0),c([v({type:cc.Label,tooltip:"Turns count label."}),n("design:type","function"==typeof(a="undefined"!=typeof cc&&cc.Label)?a:Object)],f.prototype,"turnsCountLabel",void 0),c([v({type:cc.Node,tooltip:"Score panel."}),n("design:type","function"==typeof(i="undefined"!=typeof cc&&cc.Node)?i:Object)],f.prototype,"scorePanel",void 0),c([v({type:cc.Label,tooltip:"Score count label."}),n("design:type","function"==typeof(r="undefined"!=typeof cc&&cc.Label)?r:Object)],f.prototype,"scoreCountLabel",void 0),f=c([m,_],f),o.Hud=f,cc._RF.pop()},{"../../../../global-init":"global-init","@cc_components/hud/TurnsCounter":void 0,"@cc_platform/animation/CCParallelAnimationPlayer":void 0,"game/GameStatus":void 0}],Main:[function(e,t,o){"use strict";cc._RF.push(t,"582abnwx9lKi4wew1sBpFJv","Main");var s,a,i,r,c,n,l,d,u=this&&this.__decorate||function(e,t,o,s){var a,i=arguments.length,r=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,s);else for(var c=e.length-1;c>=0;c--)(a=e[c])&&(r=(i<3?a(r):i>3?a(t,o,r):a(t,o))||r);return i>3&&r&&Object.defineProperty(t,o,r),r},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(o,"__esModule",{value:!0});const h=e("./global-init"),m=e("@cc_components/board/Board"),_=e("@cc_components/boosters/Boosters"),v=e("@cc_components/hud/Hud"),f=e("@cc_platform/audio/CCAudioPlayer"),y=e("@cc_platform/gameloop/CCGameLoopUpdateAgent"),g=e("@cc_prefabs/board/BlocksSet"),P=e("@cc_prefabs/board/ScoresSet"),b=e("core/event/EventBus"),B=e("core/gameloop/GameLoop"),S=e("core/systems/action/ActionManager"),k=e("core/systems/animation/AnimationManager"),R=e("core/systems/audio/AudioVoice"),A=e("core/systems/audio/MusicManager"),T=e("core/systems/audio/SoundsManager"),M=e("core/systems/PauseManager"),C=e("game/GameFlowControl"),w=e("game/logic/blocks/BlocksField"),F=e("game/logic/score/ScoreFieldData"),I=e("game/service/GameProcessMapper"),O=e("game/state/GameFlowStateID"),D=e("game/state/StatesFactory"),E=e("game/state/StrategiesProvider"),L=e("game/turn_cycle/GameProcessModel"),G=e("game/turn_cycle/PlayerTurnModel"),x=e("game/ui/board/BoardUI"),N=e("game/ui/boosts/BoostsUI"),U=e("game/ui/hud/HudUI"),j=e("services/StoreService"),V=e("services/UserService"),{ccclass:W,property:H}=cc._decorator;var Y=cc._decorator.disallowMultiple;let q=class extends cc.Component{constructor(){super(...arguments),this.appSettings=h.assertProp(this,"appSettings"),this.levelSettings=h.assertProp(this,"levelSettings"),this.hud=h.assertProp(this,"hud"),this.board=h.assertProp(this,"board"),this.boosters=cc.assertProp(this,"boosters"),this.blockSet=cc.assertProp(this,"blockSet"),this.scoreSet=cc.assertProp(this,"scoreSet"),this.gameLoopUpdateProvider=cc.assertProp(this,"gameLoopUpdateProvider")}onLoad(){cc.game.addPersistRootNode(this.node),this._gameLoop=new B.GameLoop,this._pauseManager=new M.PauseManager("GLOBAL: Pause Manager"),this._pauseManager.addSystem(this._gameLoop),cc.log("MAIN LOADED")}onEnable(){cc.log("MAIN ENABLE"),this._gameLoop.start(this.gameLoopUpdateProvider,!0),this._pauseManager.resume()}start(){this._init(),cc.log("MAIN STARTED")}onDisable(){cc.log("MAIN ENABLE"),this._pauseManager.pause(),this._gameLoop.stop()}onDestroy(){cc.log("MAIN START DESTROY"),this._gameLoop.stop()}_init(){const e=this.appSettings.json,t=e.gameSettings,o=this.levelSettings.json;console.log(e),console.log(o);let s=0;const a=()=>{const e=new f.CCAudioPlayer(`PLATFORM: ccAudio Player #${++s}`);return this._pauseManager.addSystem(e),e},i=new b.EventBus,r=new R.AudioVoice("GLOBAL: Audio Voice"),c=new R.AudioVoice("GLOBAL: Music Volume",r),n=new R.AudioVoice("GLOBAL: Sounds Volume",r),l=new A.MusicManager("GLOBAL: Music Manager",c,a(),(e,t)=>{i.emit("APP.MUSIC.ENDED",{musicAlias:e,completed:t})},()=>{i.emit("APP.MUSIC.STOPPED",void 0)}),d=new b.EventBus,u=new U.HudUI(this.hud),p=new x.BoardUI(this.board),h=new N.BoostsUI(this.boosters),m=new w.BlocksField(this.board),_=new F.ScoreFieldData(this.board),v=new G.PlayerTurnModel(()=>_,_),y=new L.GameProcessModel(o),g={boardView:p,boardDataProvider:()=>m,boardDataEditor:m,eventDispatcher:d,eventEmitter:d,settings:{gameplay:t,currLevel:()=>o},gameProcess:{playerTurnModelProvider:()=>v,playerTurnResultAgent:v,playerTurnFlowActorsOrderedList:[v,y,[u,p,h]],gameProcessModelProvider:()=>y,gameProcessResultAgent:y,gameProcessResultObservers:[u,p,h]},systems:{pause:{provide:(e,t)=>new M.PauseManager(e,t||this._pauseManager),release:e=>{e!=this._pauseManager&&e.destroy()}},actions:{provide:e=>{const t=new S.ActionManager(e);return this._gameLoop.add(t),t},release:e=>{e.cancelAll(),this._gameLoop.remove(e)}},animations:{provide:e=>{const t=new k.AnimationManager(e);return this._gameLoop.add(t),t},release:e=>{e.cancelAll(),this._gameLoop.remove(e)}},sounds:{provide:e=>{const t=new T.SoundsManager(e,n,a);return this._gameLoop.add(t),t},release:e=>{e.stopAll(),this._gameLoop.remove(e)}},music:{provide:()=>l}},services:{gameProcessMapper:new I.GameProcessMapper,storeService:new j.StoreService,userProgressSaveService:new V.UserService}};this._gameLoopInit([i,d,l]);const P=new C.GameFlowControl(this.board,this.boosters,g.eventDispatcher),B=new E.StrategiesProvider(g),W=new D.StatesFactory(P,B,g);console.log(P),P.start(W.getState(O.GameplayStateID.BOARD_READY)).then(()=>{console.info("GAME CONTROL STARTED")}).catch(e=>{console.error("GAME CONTROL ERROR",e)})}_gameLoopInit(e){for(const t of e)this._gameLoop.add(t)}};u([H(cc.JsonAsset),p("design:type","function"==typeof(s="undefined"!=typeof cc&&cc.JsonAsset)?s:Object)],q.prototype,"appSettings",void 0),u([H(cc.JsonAsset),p("design:type","function"==typeof(a="undefined"!=typeof cc&&cc.JsonAsset)?a:Object)],q.prototype,"levelSettings",void 0),u([H({type:v.Hud,tooltip:"Link to HUD view."}),p("design:type","function"==typeof(i=void 0!==v.Hud&&v.Hud)?i:Object)],q.prototype,"hud",void 0),u([H({type:m.Board,tooltip:"Link to Board view."}),p("design:type","function"==typeof(r=void 0!==m.Board&&m.Board)?r:Object)],q.prototype,"board",void 0),u([H({type:_.Boosters,tooltip:"Link to Boosters buttons block."}),p("design:type","function"==typeof(c=void 0!==_.Boosters&&_.Boosters)?c:Object)],q.prototype,"boosters",void 0),u([H({type:g.BlocksSet}),p("design:type","function"==typeof(n=void 0!==g.BlocksSet&&g.BlocksSet)?n:Object)],q.prototype,"blockSet",void 0),u([H({type:P.ScoresSet}),p("design:type","function"==typeof(l=void 0!==P.ScoresSet&&P.ScoresSet)?l:Object)],q.prototype,"scoreSet",void 0),u([H({type:y.CCGameLoopUpdateAgent}),p("design:type","function"==typeof(d=void 0!==y.CCGameLoopUpdateAgent&&y.CCGameLoopUpdateAgent)?d:Object)],q.prototype,"gameLoopUpdateProvider",void 0),q=u([W,Y],q),o.default=q,cc._RF.pop()},{"./global-init":"global-init","@cc_components/board/Board":void 0,"@cc_components/boosters/Boosters":void 0,"@cc_components/hud/Hud":void 0,"@cc_platform/audio/CCAudioPlayer":void 0,"@cc_platform/gameloop/CCGameLoopUpdateAgent":void 0,"@cc_prefabs/board/BlocksSet":void 0,"@cc_prefabs/board/ScoresSet":void 0,"core/event/EventBus":void 0,"core/gameloop/GameLoop":void 0,"core/systems/PauseManager":void 0,"core/systems/action/ActionManager":void 0,"core/systems/animation/AnimationManager":void 0,"core/systems/audio/AudioVoice":void 0,"core/systems/audio/MusicManager":void 0,"core/systems/audio/SoundsManager":void 0,"game/GameFlowControl":void 0,"game/logic/blocks/BlocksField":void 0,"game/logic/score/ScoreFieldData":void 0,"game/service/GameProcessMapper":void 0,"game/state/GameFlowStateID":void 0,"game/state/StatesFactory":void 0,"game/state/StrategiesProvider":void 0,"game/turn_cycle/GameProcessModel":void 0,"game/turn_cycle/PlayerTurnModel":void 0,"game/ui/board/BoardUI":void 0,"game/ui/boosts/BoostsUI":void 0,"game/ui/hud/HudUI":void 0,"services/StoreService":void 0,"services/UserService":void 0}],MusicManager:[function(e,t,o){"use strict";cc._RF.push(t,"e30d9/ZZ91Nl4xvedk7EoR8","MusicManager");var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))(function(a,i){function r(e){try{n(s.next(e))}catch(t){i(t)}}function c(e){try{n(s.throw(e))}catch(t){i(t)}}function n(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(r,c)}n((s=s.apply(e,t||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0}),o.MusicManager=void 0;const a=e("core/gameloop/GameLoopPhase"),i=e("core/systems/action/DelayAction");o.MusicManager=class{constructor(e,t,o,s,i){this.updatePhase=a.GameLoopPhase.AUDIO,this._paused=!1,this.name=e,this._voice=t,this._audioPlayer=o,this._onMusicEnd=s,this._onMusicStop=i}get paused(){return this._paused}get activeTrack(){return this._activeTrack}get _actualMuted(){return this._voice.muted}get _actualVolume(){return this._voice.volume*(this._activeTrack?this._activeTrack.volume:1)}start(e,t){var o,a;return s(this,void 0,void 0,function*(){this._cancelFadeActions();const s=e.alias;if(this._activeTrack&&this._activeTrack.alias===s)return this._applyTrackOptions(this._activeTrack,e,!0),!0;const r=(null==t?void 0:t.fadeOutTimeSec)||(null===(o=this._activeTrack)||void 0===o?void 0:o.fadeOptions.fadeOutTimeSec)||0;this._fadeOutAction=new i.DelayAction(this._activeTrack?r:0);const c=yield this._fadeOutAction.waitFinish();if(delete this._fadeOutAction,"cancelled"==c)return!1;this._activeTrack&&this._audioPlayer.stop(this._activeTrack.alias),this._activeTrack=e;const n=this._audioPlayer.play(s,{volume:0,muted:this._actualMuted,loop:this._activeTrack.loop});if(!n)return!1;this._voice.onUpdateCallbacks.add(this),n.then(e=>{var t;null===(t=this._onMusicEnd)||void 0===t||t.call(this,s,"completed"==e)},()=>{var e;null===(e=this._onMusicEnd)||void 0===e||e.call(this,s,!1)});const l=(null==t?void 0:t.fadeInTimeSec)||(null===(a=this._activeTrack)||void 0===a?void 0:a.fadeOptions.fadeInTimeSec)||0;this._fadeInAction=new i.DelayAction(this._activeTrack?l:0);const d=yield this._fadeInAction.waitFinish();return delete this._fadeInAction,"cancelled"!=d})}stop(e,t,o){var a,r;return s(this,void 0,void 0,function*(){if(this._voice.onUpdateCallbacks.delete(this),this._cancelFadeActions(),!this._activeTrack)return;if(e)return this._audioPlayer.stop(this._activeTrack.alias),void(o||null===(a=this._onMusicStop)||void 0===a||a.call(this));const s=this._activeTrack.alias,c=t||this._activeTrack.fadeOptions.fadeOutTimeSec||0;this._fadeOutAction=new i.DelayAction(c),yield this._fadeOutAction.waitFinish(),delete this._fadeOutAction,this._activeTrack&&this._audioPlayer.stop(s),delete this._activeTrack,o||null===(r=this._onMusicStop)||void 0===r||r.call(this)})}_cancelFadeActions(){this._fadeOutAction&&(this._fadeOutAction.cancel(),delete this._fadeOutAction),this._fadeInAction&&(this._fadeInAction.cancel(),delete this._fadeInAction)}pause(){this._paused=!0,this._audioPlayer.pause()}resume(){this._paused=!1,this._audioPlayer.resume()}update(e){var t,o,s,a;this._paused||(this._fadeOutAction&&(null===(o=(t=this._fadeOutAction).update)||void 0===o||o.call(t,e),this._activeTrack&&this._audioPlayer.setVolume(this._activeTrack.alias,this._actualVolume-this._actualVolume*this._fadeOutAction.progress)),this._fadeInAction&&(null===(a=(s=this._fadeInAction).update)||void 0===a||a.call(s,e),this._activeTrack&&this._audioPlayer.setVolume(this._activeTrack.alias,this._actualVolume*this._fadeInAction.progress)))}onUpdateVoice(e){this._activeTrack&&(this._fadeOutAction||this._fadeInAction||this._audioPlayer.setVolume(this._activeTrack.alias,this._actualVolume),e.muted?this._audioPlayer.mute(this._activeTrack.alias):this._audioPlayer.unmute(this._activeTrack.alias))}_applyTrackOptions(e,t,o){e.alias===t.alias&&(e.loop!=t.loop&&(e.loop=t.loop,o&&this._audioPlayer.setLoop(t.alias,t.loop)),e.volume!=t.volume&&(e.volume=t.volume,o&&this._audioPlayer.setVolume(t.alias,t.volume)),t.fadeOptions&&(e.fadeOptions=t.fadeOptions))}},cc._RF.pop()},{"core/gameloop/GameLoopPhase":void 0,"core/systems/action/DelayAction":void 0}],PauseManager:[function(e,t,o){"use strict";cc._RF.push(t,"bac63657H1FJK3YHpUmOTHy","PauseManager"),Object.defineProperty(o,"__esModule",{value:!0}),o.PauseManager=void 0,o.PauseManager=class{constructor(e,t){var o;this._paused=!1,this._systems=new Set,this.name=e,this._masterManager=t,null===(o=this._masterManager)||void 0===o||o.addSystem(this)}get paused(){return this._paused}addSystem(e){this._systems.add(e),this.paused!=e.paused&&(this.paused?e.pause():e.resume())}removeSystem(e,t){return!0===t?e.pause():!1===t&&e.resume(),this._systems.delete(e)}pause(){this._paused=!0;for(const e of this._systems)e.pause()}resume(){this._paused=!1;for(const e of this._systems)e.resume()}destroy(){var e;this._systems.clear(),null===(e=this._masterManager)||void 0===e||e.removeSystem(this)}},cc._RF.pop()},{}],PickRandomBlocksMethod:[function(e,t,o){"use strict";cc._RF.push(t,"46d360mBY5JDpI/59mzmHdC","PickRandomBlocksMethod"),Object.defineProperty(o,"__esModule",{value:!0}),o.PickRandomBlocksMethod=void 0;const s=e("game/logic/blocks/BlocksField");o.PickRandomBlocksMethod=class{constructor(e,t,o){this._options={blocksToPickMin:0,blocksToPickMax:0,maxBlocksAtOneWave:0},this._fieldProvider=e,this._blockTypeFilter=o,this._initPickOptions(this._fieldProvider(),t)}get blocksData(){return this._fieldProvider()}_initPickOptions(e,t){const o=e.rows*e.columns;t.blocksToPickMin?this._options.blocksToPickMin=Math.max(1,Math.min(o,t.blocksToPickMin)):this._options.blocksToPickMin=1,t.blocksToPickMax?this._options.blocksToPickMax=Math.max(1,Math.min(o,t.blocksToPickMax)):this._options.blocksToPickMax=o,t.maxBlocksAtOneWave?this._options.maxBlocksAtOneWave=Math.max(1,Math.min(o,t.maxBlocksAtOneWave)):this._options.maxBlocksAtOneWave=1}execute(){const e=this._fieldProvider(),t=[];let o=[];const a=this._options.blocksToPickMin+Math.round((this._options.blocksToPickMax-this._options.blocksToPickMin)*Math.random()),i=e.sectors;let r=0;for(;i.length&&r<a;){const[a,c]=this._getRandomSector(i),n=e.getDataAt(a,c);if(s.isBlockTypeData(n)&&(!this._blockTypeFilter||this._blockTypeFilter(n))){r++,o.push([a,c]);const e=1+Math.round((this._options.maxBlocksAtOneWave-1)*Math.random());o.length>=e&&(t.push(o),o=[])}}return t}_getRandomSector(e){const t=e.length*Math.random()|0;return e.splice(t,1)[0]}},cc._RF.pop()},{"game/logic/blocks/BlocksField":void 0}],PlayerBoost:[function(e,t,o){"use strict";cc._RF.push(t,"78d4aszbbVAMKPHMzZc9tag","PlayerBoost"),Object.defineProperty(o,"__esModule",{value:!0}),o.PlayerBoost=void 0;const s=e("game/state/game-flow-state"),a=e("game/state/GameFlowStateBase"),i=e("game/state/GameFlowStateID");o.PlayerBoost=class extends a.GameFlowStateBase{constructor(e,t,o,s,a){super(!1,e,t,o,s,a),this.stateId=i.GameplayStateID.PLAYER_BOOST}goBoostUsage(){return s.ignoreTransition()}goPlayerTurn(){return this.transitToState(i.GameplayStateID.PLAYER_TURN,void 0)}goUpdateBoard(){return this.transitToState(i.GameplayStateID.BOARD_UPDATE,void 0)}goPlayerWin(){return this.transitToState(i.GameplayStateID.PLAYER_WIN,void 0)}goPlayerLose(){return this.transitToState(i.GameplayStateID.PLAYER_LOSE,void 0)}},cc._RF.pop()},{"game/state/GameFlowStateBase":void 0,"game/state/GameFlowStateID":void 0,"game/state/game-flow-state":void 0}],PlayerCalculateTurnResult:[function(e,t,o){"use strict";cc._RF.push(t,"8bad1j6LJ5KQ7jtpLRepunc","PlayerCalculateTurnResult");var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))(function(a,i){function r(e){try{n(s.next(e))}catch(t){i(t)}}function c(e){try{n(s.throw(e))}catch(t){i(t)}}function n(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(r,c)}n((s=s.apply(e,t||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0}),o.PlayerCalculateTurnResult=void 0;o.PlayerCalculateTurnResult=class{constructor(e,t,o){this._boardView=e,this._playerTurnResultProvider=t,this._applyMethod=o}perform(){return s(this,void 0,void 0,function*(){yield this._collapseBlocks()})}_collapseBlocks(){return s(this,void 0,void 0,function*(){const e=this._applyMethod.execute(),t=[];t.push(this._boardView.collapseBlocks(this._applyMethod.blocksData,e)),yield wait(250);const o=this._playerTurnResultProvider();t.push(this._boardView.showScores(...o.scoreBySectors)),yield Promise.all(t)})}},cc._RF.pop()},{}],PlayerHandleBoostActivated:[function(e,t,o){"use strict";cc._RF.push(t,"2fbaa5sC1FNh7uYdQEWZUaE","PlayerHandleBoostActivated");var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))(function(a,i){function r(e){try{n(s.next(e))}catch(t){i(t)}}function c(e){try{n(s.throw(e))}catch(t){i(t)}}function n(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(r,c)}n((s=s.apply(e,t||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0}),o.PlayerHandleBoostActivated=void 0,o.PlayerHandleBoostActivated=class{constructor(e,t,o,s){this._boostId=e,this._gameProcessAgent=t,this._availableBoostsProvider=o,this._boostFlowParticipants=s}perform(){return s(this,void 0,void 0,function*(){this._gameProcessAgent.enterBooster(this._boostId);for(const e of this._boostFlowParticipants)if(Array.isArray(e)){const t=[];for(const o of e)t.push(o.onBoostActivate(this._boostId,this._availableBoostsProvider().boosters));yield Promise.all(t)}else yield e.onBoostActivate(this._boostId,this._availableBoostsProvider().boosters)})}},cc._RF.pop()},{}],PlayerHandleLostStatus:[function(e,t,o){"use strict";cc._RF.push(t,"8c3af45ddtN3Ln7rgDjQuhT","PlayerHandleLostStatus"),Object.defineProperty(o,"__esModule",{value:!0}),o.PlayerHandleLostStatus=void 0,o.PlayerHandleLostStatus=class{perform(){return Promise.resolve()}},cc._RF.pop()},{}],PlayerHandleResultComplete:[function(e,t,o){"use strict";cc._RF.push(t,"879356ItvNBk5/fnKBbC5BQ","PlayerHandleResultComplete");var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))(function(a,i){function r(e){try{n(s.next(e))}catch(t){i(t)}}function c(e){try{n(s.throw(e))}catch(t){i(t)}}function n(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(r,c)}n((s=s.apply(e,t||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0}),o.PlayerHandleResultComplete=void 0,o.PlayerHandleResultComplete=class{constructor(e,t,o){this._turnResultProvider=e,this._gameProcessResultProvider=t,this._turnFlowParticipants=o}perform(){return s(this,void 0,void 0,function*(){for(const e of this._turnFlowParticipants)if(Array.isArray(e)){const t=[];for(const o of e)t.push(o.onCompleteResult(this._turnResultProvider(),this._gameProcessResultProvider()));yield Promise.all(t)}else yield e.onCompleteResult(this._turnResultProvider(),this._gameProcessResultProvider())})}},cc._RF.pop()},{}],PlayerHandleTurnModeEnded:[function(e,t,o){"use strict";cc._RF.push(t,"4b1813BxOxCx5EkN1u957Tg","PlayerHandleTurnModeEnded");var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))(function(a,i){function r(e){try{n(s.next(e))}catch(t){i(t)}}function c(e){try{n(s.throw(e))}catch(t){i(t)}}function n(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(r,c)}n((s=s.apply(e,t||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0}),o.PlayerHandleTurnModeEnded=void 0,o.PlayerHandleTurnModeEnded=class{constructor(e,t){this._turnsNumeratorProvider=e,this._turnFlowParticipants=t}perform(){return s(this,void 0,void 0,function*(){const e=this._turnsNumeratorProvider();for(const t of this._turnFlowParticipants)if(Array.isArray(t)){const o=[];for(const s of t)o.push(s.onEndTurn(e.turnsCompleted,e.turnsLeft));yield Promise.all(o)}else yield t.onEndTurn(e.turnsCompleted,e.turnsLeft)})}},cc._RF.pop()},{}],PlayerHandleWinStatus:[function(e,t,o){"use strict";cc._RF.push(t,"0f224Ux9XhAMbjUGzqxV4/B","PlayerHandleWinStatus"),Object.defineProperty(o,"__esModule",{value:!0}),o.PlayerHandleWinStatus=void 0,o.PlayerHandleWinStatus=class{perform(){return Promise.resolve()}},cc._RF.pop()},{}],PlayerLoseState:[function(e,t,o){"use strict";cc._RF.push(t,"c0d83tb9CRNLLSfnSfz98h6","PlayerLoseState"),Object.defineProperty(o,"__esModule",{value:!0}),o.PlayerLoseState=void 0;const s=e("game/state/game-flow-state"),a=e("game/state/GameFlowStateBase"),i=e("game/state/GameFlowStateID");o.PlayerLoseState=class extends a.GameFlowStateBase{constructor(e,t,o,s){super(!1,e,t,o,s),this.stateId=i.GameplayStateID.PLAYER_LOSE}goPlayerLose(){return s.ignoreTransition()}},cc._RF.pop()},{"game/state/GameFlowStateBase":void 0,"game/state/GameFlowStateID":void 0,"game/state/game-flow-state":void 0}],PlayerResultState:[function(e,t,o){"use strict";cc._RF.push(t,"63303KxJsxFxI+/OdEE7CrU","PlayerResultState"),Object.defineProperty(o,"__esModule",{value:!0}),o.PlayerResultState=void 0;const s=e("game/state/game-flow-state"),a=e("game/state/GameFlowStateBase"),i=e("game/state/GameFlowStateID");o.PlayerResultState=class extends a.GameFlowStateBase{constructor(e,t,o,s,a){super(!1,e,t,o,s,a),this.stateId=i.GameplayStateID.PLAYER_RESULT}goPlayerResult(){return s.ignoreTransition()}goUpdateBoard(){return this.transitToState(i.GameplayStateID.BOARD_UPDATE,void 0)}goPlayerWin(){return this.transitToState(i.GameplayStateID.PLAYER_WIN,void 0)}goPlayerLose(){return this.transitToState(i.GameplayStateID.PLAYER_LOSE,void 0)}},cc._RF.pop()},{"game/state/GameFlowStateBase":void 0,"game/state/GameFlowStateID":void 0,"game/state/game-flow-state":void 0}],PlayerTurnModel:[function(e,t,o){"use strict";cc._RF.push(t,"53326vplS5PEqhzNKI7/Jf2","PlayerTurnModel"),Object.defineProperty(o,"__esModule",{value:!0}),o.PlayerTurnModel=void 0,o.PlayerTurnModel=class{constructor(e,t){this._score=0,this._scoreWaves=[],this._reward={teleport:0,bomb:0},this._scoresFieldProvider=e,this._scoresFieldEditor=t}get score(){return this._score}get scoreBySectors(){return[this._scoresFieldProvider(),this._scoreWaves]}get reward(){return this._reward}onStartTurn(){return this._score=0,this._scoreWaves.length=0,this._scoresFieldEditor.clear(),this._reward.teleport=0,this._reward.bomb=0,Promise.resolve()}onBoostActivate(e){return console.log(e),Promise.resolve()}onEndTurn(){return this._score=0,this._scoreWaves.length=0,this._scoresFieldEditor.clear(),this._reward.teleport=0,this._reward.bomb=0,Promise.resolve()}onCompleteResult(){return Promise.resolve()}addScore(e){this._score+=e}addToScoreInfoValue(e,t){const o=this._scoresFieldProvider().getDataAt(t);let s=o?o[0]:0,a=!!o&&o[1];s+=e[0],a||(a=e[1]),this._scoresFieldEditor.setDataAt(t,[s,a])}setScoresWaves(e){this._scoreWaves=[...e.map(e=>[...e])]}addReward(e){this._reward=Object.assign({},e)}},cc._RF.pop()},{}],PlayerTurnState:[function(e,t,o){"use strict";cc._RF.push(t,"79482TSxlFJPpgriRlA6Wbb","PlayerTurnState"),Object.defineProperty(o,"__esModule",{value:!0}),o.PlayerTurnState=void 0;const s=e("game/state/game-flow-state"),a=e("game/state/GameFlowStateBase"),i=e("game/state/GameFlowStateID");o.PlayerTurnState=class extends a.GameFlowStateBase{constructor(e,t,o,s,a){super(!0,e,t,s,a,o),this.stateId=i.GameplayStateID.PLAYER_TURN}goPlayerTurn(){return s.ignoreTransition()}goBoostUsage(e){return this.transitToState(i.GameplayStateID.PLAYER_BOOST,{boost:e})}goPlayerResult(e){return this.transitToState(i.GameplayStateID.PLAYER_RESULT,{activeBlock:e})}},cc._RF.pop()},{"game/state/GameFlowStateBase":void 0,"game/state/GameFlowStateID":void 0,"game/state/game-flow-state":void 0}],PlayerWaitTurnAction:[function(e,t,o){"use strict";cc._RF.push(t,"d50ddI1Bg5Pw5e1YY4/zu4A","PlayerWaitTurnAction"),Object.defineProperty(o,"__esModule",{value:!0}),o.PlayerWaitTurnAction=void 0;o.PlayerWaitTurnAction=class{constructor(e,t){this._doBlocksIdleShake=()=>{const e=this._getBlockForIdleShakeMethod.execute();this._boardView.idleShakeBoardBlocks(e)},this._boardView=e,this._getBlockForIdleShakeMethod=t}perform(){return this._requestBlocksIdleShake(),new Promise(()=>{})}_requestBlocksIdleShake(){const e=7e3+Math.round(8e3*Math.random());wait(e).then(()=>{this._doBlocksIdleShake(),this._requestBlocksIdleShake()})}},cc._RF.pop()},{}],PlayerWinState:[function(e,t,o){"use strict";cc._RF.push(t,"bdda48GUfhHU51GdemIU4hz","PlayerWinState"),Object.defineProperty(o,"__esModule",{value:!0}),o.PlayerWinState=void 0;const s=e("game/state/game-flow-state"),a=e("game/state/GameFlowStateBase"),i=e("game/state/GameFlowStateID");o.PlayerWinState=class extends a.GameFlowStateBase{constructor(e,t,o,s){super(!1,e,t,o,s),this.stateId=i.GameplayStateID.PLAYER_WIN}goPlayerWin(){return s.ignoreTransition()}},cc._RF.pop()},{"game/state/GameFlowStateBase":void 0,"game/state/GameFlowStateID":void 0,"game/state/game-flow-state":void 0}],ProcessBlocksByInitialOneMethod:[function(e,t,o){"use strict";cc._RF.push(t,"87d2ea65ktEkJ+6ZPoWwQ50","ProcessBlocksByInitialOneMethod"),Object.defineProperty(o,"__esModule",{value:!0}),o.ProcessBlocksByInitialOneMethod=void 0;const s=e("game/logic/blocks/BlocksField"),a=e("game/logic/blocks/BlockSpecialType");o.ProcessBlocksByInitialOneMethod=class{constructor(e,t,o,s,a,i,r,c){this._fieldProvider=e,this._fieldEditor=t,this._blockPosition=o,this._playerTurnResultProvider=s,this._playerTurnResultAgent=a,this._blockActionStrategyProvider=i,this._scoreCalculatorProvider=r,this._rewardCalculatorProvider=c}get blocksData(){return this._fieldProvider()}execute(){return this._blockPosition?this._calculate(this._fieldProvider(),this._blockPosition,this._scoreCalculatorProvider()):[]}_calculate(e,t,o){const a=[],i=e.getDataAt(t);if(!s.isBlockTypeData(i))return a;const r=this._blockActionStrategyProvider(i).action(e,t);let c=1;for(const s of r){s.length&&a.push(s);for(const t of s)this._processBlock(t,e,o);this._processWave(s,c++,o)}return this._playerTurnResultAgent.setScoresWaves(a),this._playerTurnResultAgent.addReward(this._rewardCalculatorProvider()(this._playerTurnResultProvider().score,r)),a}_processBlock(e,t,o){const i=t.getDataAt(e);if(!s.isBlockTypeData(i))return;this._fieldEditor.removeData(e);const r=o.scoreByBlock(i);this._playerTurnResultAgent.addScore(r),this._playerTurnResultAgent.addToScoreInfoValue([r,a.isSpecialBlock(i)],e)}_processWave(e,t,o){if(!e.length)return;const s=o.scoreByWave(e,t);this._playerTurnResultAgent.addScore(s.reduce((e,t)=>e+t,0));for(let a=0;a<e.length;a++){const t=e[a];this._playerTurnResultAgent.addToScoreInfoValue([s[a],!1],t)}}},cc._RF.pop()},{"game/logic/blocks/BlockSpecialType":void 0,"game/logic/blocks/BlocksField":void 0}],ProcessBoostBombMethod:[function(e,t,o){"use strict";cc._RF.push(t,"1dea3r3N99Fnqmg4CJD0YbF","ProcessBoostBombMethod"),Object.defineProperty(o,"__esModule",{value:!0}),o.ProcessBoostBombMethod=void 0;const s=e("game/logic/blocks/BlockColorType"),a=e("game/logic/blocks/BlocksField"),i=e("game/logic/blocks/BlockSpecialType");o.ProcessBoostBombMethod=class{constructor(e,t,o,s,a,i){this._playerTurnResultProvider=o,this._fieldProvider=e,this._fieldEditor=t,this._playerTurnResultAgent=s,this._scoreCalculatorProvider=a,this._rewardCalculatorProvider=i}get blocksData(){return this._fieldProvider()}execute(){const e=this._fieldProvider(),[t,o]=this._analyseGameField(e);let r,c=0;for(const a of o.keys())if(s.isSimpleBlock(a)){const e=o.get(a);e>c&&(c=e,r=a)}const n=[],l=this._scoreCalculatorProvider(),d=t.get(r);for(const s of d){const t=[s];n.push(t);const o=e.getDataAt(s);if(a.isBlockTypeData(o)){const e=l.scoreByBlock(o);this._playerTurnResultAgent.addScore(e),this._playerTurnResultAgent.addToScoreInfoValue([e,i.isSpecialBlock(o)],s);const a=l.scoreByWave(t,n.length);this._playerTurnResultAgent.addScore(a.reduce((e,t)=>e+t,0));for(let o=0;o<t.length;o++){const e=t[o];this._playerTurnResultAgent.addToScoreInfoValue([a[o],!1],e)}}this._fieldEditor.removeData(s)}this._playerTurnResultAgent.setScoresWaves(n);const u=this._rewardCalculatorProvider()(this._playerTurnResultProvider().score,n);return console.log(u),n}_analyseGameField(e){const t=new Map,o=new Map;for(const[s,i]of e.data)if(a.isBlockTypeData(s)){const e=t.get(s)||[];let a=o.get(s)||0;e.push(i),a++,t.set(s,e),o.set(s,a)}return[t,o]}},cc._RF.pop()},{"game/logic/blocks/BlockColorType":void 0,"game/logic/blocks/BlockSpecialType":void 0,"game/logic/blocks/BlocksField":void 0}],ProcessBoostTeleportMethod:[function(e,t,o){"use strict";cc._RF.push(t,"c291dsQtX5EH7k9ft5fDP+x","ProcessBoostTeleportMethod"),Object.defineProperty(o,"__esModule",{value:!0}),o.ProcessBoostTeleportMethod=void 0;const s=e("game/logic/blocks/BlocksField");o.ProcessBoostTeleportMethod=class{constructor(e,t,o){this._fieldProvider=e,this._fieldEditor=t,this._pickMethod=o}get blocksData(){return this._fieldProvider()}execute(){const e=this._pickMethod.execute(),t=[],o=[],a=[],i=[o,a];let r=1;for(const s of e)for(const e of s)i[r^=1].push(e);const c=Math.min(o.length,a.length);for(let n=0;n<c;n++){const e=o[n],i=a[n],r=[e,i];t.push(r);const c=this._fieldProvider(),l=c.getDataAt(e),d=c.getDataAt(i);s.isBlockTypeData(l)&&s.isBlockTypeData(d)&&(this._fieldEditor.setDataAt(i,l),this._fieldEditor.setDataAt(e,d))}return t}},cc._RF.pop()},{"game/logic/blocks/BlocksField":void 0}],RefillBoardMethod:[function(e,t,o){"use strict";cc._RF.push(t,"baf7aaRYzFKELttW9OhRXeW","RefillBoardMethod"),Object.defineProperty(o,"__esModule",{value:!0}),o.RefillBoardMethod=void 0;const s=e("game/logic/blocks/BlockColorType"),a=e("game/logic/blocks/BlockSpecialType");o.RefillBoardMethod=class{constructor(e,t,o){this._fieldProvider=e,this._fieldEditor=t,this._settings=o}get blocksData(){return this._fieldProvider()}execute(){const e=this._fieldProvider(),t=e.sectors.filter(t=>!e.hasDataAt(t));let o=Math.round(t.length*this._settings.process.fillRules.MAX_SPECIAL_BLOCKS_COUNT_MULTIPLIER*Math.random());const s=this._generateSpecialBlocksChanceMap(new Map([[a.BlockSpecialType.BOMB,this._settings.process.fillRules.BOMB_CHANCE],[a.BlockSpecialType.BOMB_MAX,this._settings.process.fillRules.BOMB_MAX_CHANCE],[a.BlockSpecialType.ROCKET_VERTICAL,this._settings.process.fillRules.ROCKET_VERTICAL_CHANCE],[a.BlockSpecialType.ROCKET_HORIZONTAL,this._settings.process.fillRules.ROCKET_HORIZONTAL_CHANCE]]));let i=t.length-o,r=1+Math.round((this._settings.behaviour.MAX_COUNT_FOR_SIMPLE_BLOCKS_FILL_WAVES-1)*Math.random());const c=[];for(;r>0&&t.length;){const e=r>1?1+Math.round((i-1)/r*Math.random()):i;i-=e,c.push(this._generateWaveOfSimpleBlocks(e,t)),r--}for(;o>0&&t.length;)c.push(this._generateWaveOfSpecialBlocks(1,t,s)),o--;return c}_generateWaveOfSimpleBlocks(e,t){const o=[];for(;e>0&&t.length;){const s=this._getRandomColorBlock(),a=this._pickRandomSectorForSimpleBlock(t);o.push(a),this._fieldEditor.setDataAt(...a,s),e--}return o}_generateWaveOfSpecialBlocks(e,t,o){const s=[];for(;e>0&&t.length;){const a=this._getRandomSpecialBlock(o),i=this._pickRandomSectorForSpecialBlock(t);s.push(i),this._fieldEditor.setDataAt(...i,a),e--}return s}_getRandomColorBlock(){return s.BlockColorTypes[Math.floor(s.BlockColorTypes.length*Math.random())]}_generateSpecialBlocksChanceMap(e){const t=[];for(const o of e.keys()){const s=Math.round(1/e.get(o));t.push(...Array(s).fill(o))}return t}_getRandomSpecialBlock(e){return e[Math.floor(e.length*Math.random())]}_pickRandomSectorForSimpleBlock(e){const t=Math.floor(e.length*Math.random());return e.splice(t,1)[0]}_pickRandomSectorForSpecialBlock(e){const t=Math.floor(e.length*Math.random());return e.splice(t,1)[0]}},cc._RF.pop()},{"game/logic/blocks/BlockColorType":void 0,"game/logic/blocks/BlockSpecialType":void 0}],RocketActivator:[function(e,t,o){"use strict";cc._RF.push(t,"e9c51K4MDFBarBjn5Ift/Ch","RocketActivator"),Object.defineProperty(o,"__esModule",{value:!0}),o.RocketActivator=void 0;const s=e("game/logic/blocks/special/RocketType");o.RocketActivator=class{constructor(e,t){this._direction=e,this._lineDistance=t}activateBlocks(e,t,o){const s=[],a=[e],i=[],r=this._lineDistance||Math.max(t.rows,t.columns);for(let c=1;c<=r&&a.length;c++){const e=a.splice(0,a.length);for(const r of e){const e=this._getAroundLineSectors(r,t);for(const t of e){o(t)&&s.push(t);const[e,r]=t;i[e]||(i[e]=[]),i[e][r]||(a.push(t),i[e][r]=!0)}}}return s}_getAroundLineSectors(e,t){const[o,a]=e;switch(this._direction){case s.RocketType.HORIZONTAL:return 1==a?[[o,a+1]]:a==t.columns?[[o,a-1]]:[[o,a-1],[o,a+1]];case s.RocketType.VERTICAL:return 1==o?[[o+1,a]]:o==t.rows?[[o-1,a]]:[[o-1,a],[o+1,a]];case s.RocketType.DIAGONAL_TL_BR:return o==t.rows||1==a?[[o-1,a+1]]:1==o||a==t.columns?[[o+1,a-1]]:[[o+1,a-1],[o-1,a+1]];case s.RocketType.DIAGONAL_TR_BL:return o==t.rows||a==t.columns?[[o-1,a-1]]:1==o||1==a?[[o+1,a+1]]:[[o+1,a+1],[o-1,a-1]];default:assertNever(this._direction)}}},cc._RF.pop()},{"game/logic/blocks/special/RocketType":void 0}],RocketType:[function(e,t,o){"use strict";cc._RF.push(t,"43973hQYFxJA40dQNFekKWh","RocketType"),Object.defineProperty(o,"__esModule",{value:!0}),o.RocketType=void 0,o.RocketType={VERTICAL:0,HORIZONTAL:1,DIAGONAL_TL_BR:2,DIAGONAL_TR_BL:3},cc._RF.pop()},{}],ScoreFieldData:[function(e,t,o){"use strict";cc._RF.push(t,"ccaedRY/w5CpZrzcrFkkkb5","ScoreFieldData"),Object.defineProperty(o,"__esModule",{value:!0}),o.ScoreFieldData=void 0;const s=e("game/logic/field/FieldData");o.ScoreFieldData=class extends s.FieldData{constructor(e){super(e.rowsCount,e.columnsCount,0)}},cc._RF.pop()},{"game/logic/field/FieldData":void 0}],ScoreInfo:[function(e,t,o){"use strict";cc._RF.push(t,"8e2d1a/d7BCQqFJrr9ZvdKb","ScoreInfo");var s,a,i=this&&this.__decorate||function(e,t,o,s){var a,i=arguments.length,r=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,s);else for(var c=e.length-1;c>=0;c--)(a=e[c])&&(r=(i<3?a(r):i>3?a(t,o,r):a(t,o))||r);return i>3&&r&&Object.defineProperty(t,o,r),r},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(o,"__esModule",{value:!0}),o.ScoreInfo=void 0;const c=e("../../../../global-init"),n=e("@cc_platform/animation/CCSequentAnimationPlayer");var l=cc._decorator.ccclass,d=cc._decorator.property;let u=class extends cc.Component{constructor(){super(...arguments),this.appearAnimatedNode=c.assertProp(this,!0,()=>this.appearAnimatedNode),this.label=cc.assertProp(this,"label")}onLoad(){const e=this.appearAnimatedNode.getComponent(cc.Animation);this._appearAnimId=e.getClips()[0].name,this._player=new n.CCSequentAnimationPlayer(e)}show(e){return this.label.string=`${Math.round(1*e)/1}`,this._appearAnimWaiter||(this._appearAnimWaiter=this._player.start(this._appearAnimId).then(()=>{var e;delete this._appearAnimWaiter,null===(e=this.onAppearAnimationComplete)||void 0===e||e.call(this)})),this._appearAnimWaiter}};i([d(cc.Node),r("design:type","function"==typeof(s="undefined"!=typeof cc&&cc.Node)?s:Object)],u.prototype,"appearAnimatedNode",void 0),i([d(cc.Label),r("design:type","function"==typeof(a="undefined"!=typeof cc&&cc.Label)?a:Object)],u.prototype,"label",void 0),u=i([l],u),o.ScoreInfo=u,cc._RF.pop()},{"../../../../global-init":"global-init","@cc_platform/animation/CCSequentAnimationPlayer":void 0}],ScoresSet:[function(e,t,o){"use strict";cc._RF.push(t,"11ce5MIkbBNo5nvVq5d7t4D","ScoresSet");var s,a,i=this&&this.__decorate||function(e,t,o,s){var a,i=arguments.length,r=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,s);else for(var c=e.length-1;c>=0;c--)(a=e[c])&&(r=(i<3?a(r):i>3?a(t,o,r):a(t,o))||r);return i>3&&r&&Object.defineProperty(t,o,r),r},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(o,"__esModule",{value:!0}),o.ScoresSet=void 0;const c=e("../../../../global-init");var n=cc._decorator.ccclass,l=cc._decorator.disallowMultiple,d=cc._decorator.property;let u=class extends cc.Component{constructor(){super(...arguments),this.simpleBlocksScore=c.assertProp(this,"simpleBlocksScore"),this.specialBlocksScore=cc.assertProp(this,"specialBlocksScore")}};i([d({type:cc.Prefab,tooltip:"A prefab of score-info for simple colored blocks."}),r("design:type","function"==typeof(s="undefined"!=typeof cc&&cc.Prefab)?s:Object)],u.prototype,"simpleBlocksScore",void 0),i([d({type:cc.Prefab,tooltip:"A prefab of score-info for any special block."}),r("design:type","function"==typeof(a="undefined"!=typeof cc&&cc.Prefab)?a:Object)],u.prototype,"specialBlocksScore",void 0),u=i([n,l],u),o.ScoresSet=u,cc._RF.pop()},{"../../../../global-init":"global-init"}],ShakeToBlocksMethod:[function(e,t,o){"use strict";cc._RF.push(t,"60406cjmfFOmLlGt2HU9+qO","ShakeToBlocksMethod"),Object.defineProperty(o,"__esModule",{value:!0}),o.ShakeToBlocksMethod=void 0,o.ShakeToBlocksMethod=class{constructor(e,t){this._fieldProvider=e,this._fieldEditor=t}get blocksData(){return this._fieldProvider()}execute(){const e=this._fieldProvider();return console.log(this._fieldEditor),[e.sectors]}},cc._RF.pop()},{}],SimpleBlockAction:[function(e,t,o){"use strict";cc._RF.push(t,"ff447NK709LqLFeIRl5mCKs","SimpleBlockAction"),Object.defineProperty(o,"__esModule",{value:!0}),o.SimpleBlockAction=void 0;const s=e("game/logic/blocks/actions/BlockActionBase"),a=e("game/logic/blocks/BlockColorType");o.SimpleBlockAction=class extends s.BlockActionBase{constructor(e){super(e)}action(e,t){const o=[];if(!e.hasDataAt(t))return o;const s=e.getDataAt(t);if(!a.isSimpleBlock(s)||s!=this.blockType)return o;this.resetIncludedSectors(e.rows,e.columns),this.markSectorAsIncluded(t)&&o.push([t]);let i=this._getSameColorBlocksAround(t,e);if(!i.length)return o;for(o.push(i);;){if(!(i=this._getNextWave(i,e)).length)return o;o.push(i)}}_getNextWave(e,t){const o=[];for(const s of e)o.push(...this._getSameColorBlocksAround(s,t));return o}_getSameColorBlocksAround(e,t){const o=t.getSectorsAround(e,!1),s=[];for(const a of o)t.getDataAt(a)==this.blockType&&this.markSectorAsIncluded(a)&&s.push(a);return s}},cc._RF.pop()},{"game/logic/blocks/BlockColorType":void 0,"game/logic/blocks/actions/BlockActionBase":void 0}],SoundsManager:[function(e,t,o){"use strict";cc._RF.push(t,"43027kYbfJC4IfhUO3tp0v5","SoundsManager"),Object.defineProperty(o,"__esModule",{value:!0}),o.SoundsManager=void 0;const s=e("core/gameloop/GameLoopPhase"),a=e("core/systems/audio/Sound");o.SoundsManager=class{constructor(e,t,o){this.updatePhase=s.GameLoopPhase.AUDIO,this._paused=!1,this._active=new Set,this._activeCallbacks=new Map,this.onUpdateVoice=e=>{for(const t of this._active)t.setMasterVolume(e.volume),e.muted?t.masterMute():t.masterUnmute()},this.name=e,this._voice=t,this._audioPlayerProvider=o}get paused(){return this._paused}pause(){this._paused=!0;for(const e of this._active)e.pause()}resume(){this._paused=!1;for(const e of this._active)e.resume()}play(e,t){if(this._active.has(e)){const t=this._activeCallbacks.get(e);return Promise.resolve(t.resolver)}if(!e.play(this._audioPlayerProvider(),t))return Promise.resolve(!1);this._active.add(e),this._voice.onUpdateCallbacks.add(this);const o=new Promise(e=>{s.onCancel=()=>e("cancelled"),s.onComplete=()=>e("completed")}),s={onCancel:()=>{},onComplete:()=>{},resolver:o};return this._activeCallbacks.set(e,s),o}playByAlias(e,t){const o=new a.Sound(e);return o.setMasterVolume(this._voice.volume),this._voice.muted?o.masterMute():o.masterUnmute(),[o,this.play(o,t)]}stopByAlias(e){let t=!1;for(const o of this._active)o.alias===e&&(this._stop(o),t=!0);return t}stopAll(){for(const e of this._active)this._stop(e)}update(e){for(const t of this._active)t.playedTimeMs+=e,(t.completed||t.canceled)&&this._resolveAndClear(t)}_stop(e){this._active.has(e)&&(e.stop(),this._resolveAndClear(e))}_resolveAndClear(e){if(this._active.delete(e)){const t=this._activeCallbacks.get(e);this._activeCallbacks.delete(e),e.completed?t.onComplete():e.canceled&&t.onCancel()}0==this._active.size&&this._voice.onUpdateCallbacks.delete(this)}},cc._RF.pop()},{"core/gameloop/GameLoopPhase":void 0,"core/systems/audio/Sound":void 0}],Sound:[function(e,t,o){"use strict";cc._RF.push(t,"94fceH3qPVF9Ldr1LxS2ZgR","Sound"),Object.defineProperty(o,"__esModule",{value:!0}),o.Sound=void 0,o.Sound=class{constructor(e,t=1){this.playedTimeMs=0,this._paused=!1,this._canceled=!1,this._completed=!1,this._muted=!1,this._volume=1,this._masterVolume=1,this._masterMuted=!1,this.alias=e,this._volume=t}get playing(){return!!this._audioPlayer}get paused(){return this._paused}get completed(){return this._completed}get canceled(){return this._canceled}get muted(){return this._muted}get volume(){return this._volume}get _actualMuted(){return this.muted||this._masterMuted}get _actualVolume(){return this.volume*this._masterVolume}play(e,t){if(this.playing)return!0;const o=e.play(this.alias,{volume:this._actualVolume,muted:this._actualMuted,loop:t||!1});return!!o&&(this._audioPlayer=e,this._completed=!1,this._canceled=!1,this.playedTimeMs=0,o.then(()=>{this.playing&&(this._completed=!0,delete this._audioPlayer)},()=>{this.playing&&(this._canceled=!0,delete this._audioPlayer)}),!0)}stop(){this.playing&&(this._canceled=!0,this._audioPlayer&&(this._audioPlayer.stop(this.alias),delete this._audioPlayer))}pause(){var e;this.paused||(this._paused=!0,null===(e=this._audioPlayer)||void 0===e||e.pause())}resume(){var e;this.paused&&(this._paused=!1,null===(e=this._audioPlayer)||void 0===e||e.resume())}setVolume(e){this.volume!=e&&(this._volume=Math.max(0,Math.min(1,e)),this._updateVolumeIfPlaying())}setMasterVolume(e){this._masterVolume!=e&&(this._masterVolume=Math.max(0,Math.min(1,e)),this._updateVolumeIfPlaying())}_updateVolumeIfPlaying(){this._audioPlayer&&this._audioPlayer.setVolume(this.alias,this._actualVolume)}mute(){this.muted||(this._muted=!0,this._updateMuteIfPlaying())}unmute(){this.muted&&(this._muted=!1,this._updateMuteIfPlaying())}masterMute(){this._masterMuted||(this._masterMuted=!0,this._updateMuteIfPlaying())}masterUnmute(){this._masterMuted&&(this._masterMuted=!1,this._updateMuteIfPlaying())}_updateMuteIfPlaying(){this._audioPlayer&&(this._actualMuted?this._audioPlayer.mute(this.alias):this._audioPlayer.unmute(this.alias))}},cc._RF.pop()},{}],SpecialBlockAction:[function(e,t,o){"use strict";cc._RF.push(t,"5748fc0+WBL9qLEc6X3IzRS","SpecialBlockAction"),Object.defineProperty(o,"__esModule",{value:!0}),o.SpecialBlockAction=void 0;const s=e("game/logic/blocks/actions/BlockActionBase"),a=e("game/logic/blocks/BlockSpecialType");o.SpecialBlockAction=class extends s.BlockActionBase{constructor(e,t,o){super(e),this._currActivator=t,this._otherActivatorsProvider=o}action(e,t){const o=[];if(!e.hasDataAt(t))return o;const s=e.getDataAt(t);if(!a.isSpecialBlock(s)||s!=this.blockType)return o;this.resetIncludedSectors(e.rows,e.columns),this.markSectorAsIncluded(t)&&o.push([t]);let i=this._currActivator.activateBlocks(t,e,this.markSectorAsIncluded);if(!i.length)return o;if(o.push(i),!this._otherActivatorsProvider)return o;for(;;){if(!(i=this._getNextWave(i,e)).length)return o;o.push(i)}}_getNextWave(e,t){var o;const s=[];for(const i of e){const e=t.getDataAt(i);if(a.isSpecialBlock(e)){const a=null===(o=this._otherActivatorsProvider)||void 0===o?void 0:o.call(this,e);a&&s.push(...a.activateBlocks(i,t,this.markSectorAsIncluded))}}return s}},cc._RF.pop()},{"game/logic/blocks/BlockSpecialType":void 0,"game/logic/blocks/actions/BlockActionBase":void 0}],StatesFactory:[function(e,t,o){"use strict";cc._RF.push(t,"c732beShqRKT6XUqHzZO6IY","StatesFactory"),Object.defineProperty(o,"__esModule",{value:!0}),o.StatesFactory=void 0;const s=e("game/boosts/BoostID"),a=e("game/state/states/BoardReady"),i=e("game/state/states/BoardUpdate"),r=e("game/state/states/PlayerBoost"),c=e("./GameFlowStateID"),n=e("./states/PlayerLoseState"),l=e("./states/PlayerResultState"),d=e("./states/PlayerTurnState"),u=e("./states/PlayerWinState");o.StatesFactory=class{constructor(e,t,o){this._context=e,this._stateStrategyProvider=t,this._gameplayCtx=o}getState(e,t){switch(e){case c.GameplayStateID.BOARD_READY:return new a.BoardReady(this._context,this,...this._stateStrategyProvider.getStrategies(e,void 0));case c.GameplayStateID.PLAYER_TURN:return new d.PlayerTurnState(this._context,this,this._provideGuards(),...this._stateStrategyProvider.getStrategies(e,void 0));case c.GameplayStateID.PLAYER_BOOST:const o=t;return new r.PlayerBoost(this._context,this,...this._stateStrategyProvider.getStrategies(e,o),this._provideGuards());case c.GameplayStateID.PLAYER_RESULT:const s=t;return new l.PlayerResultState(this._context,this,...this._stateStrategyProvider.getStrategies(e,s),this._provideGuards());case c.GameplayStateID.PLAYER_WIN:return new u.PlayerWinState(this._context,this,...this._stateStrategyProvider.getStrategies(e,void 0));case c.GameplayStateID.PLAYER_LOSE:return new n.PlayerLoseState(this._context,this,...this._stateStrategyProvider.getStrategies(e,void 0));case c.GameplayStateID.BOARD_UPDATE:return new i.BoardUpdate(this._context,this,...this._stateStrategyProvider.getStrategies(e,void 0),this._provideGuards());default:assertNever(e)}}_provideGuards(){const e={canTransit:()=>!0};return{[c.GameplayStateID.BOARD_READY]:e,[c.GameplayStateID.BOARD_UPDATE]:e,[c.GameplayStateID.PLAYER_BOOST]:{canTransit:e=>{const t=this._gameplayCtx.gameProcess.gameProcessModelProvider();switch(e.boost){case s.GameplayBoostID.TELEPORT:return t.boosters.teleport>0;case s.GameplayBoostID.BOMB:return t.boosters.bomb>0;default:assertNever(e.boost)}}},[c.GameplayStateID.PLAYER_TURN]:{canTransit:()=>this._gameplayCtx.gameProcess.gameProcessModelProvider().turnsLeft>0},[c.GameplayStateID.PLAYER_RESULT]:e,[c.GameplayStateID.PLAYER_LOSE]:e,[c.GameplayStateID.PLAYER_WIN]:e}}},cc._RF.pop()},{"./GameFlowStateID":"GameFlowStateID","./states/PlayerLoseState":"PlayerLoseState","./states/PlayerResultState":"PlayerResultState","./states/PlayerTurnState":"PlayerTurnState","./states/PlayerWinState":"PlayerWinState","game/boosts/BoostID":void 0,"game/state/states/BoardReady":void 0,"game/state/states/BoardUpdate":void 0,"game/state/states/PlayerBoost":void 0}],StoreService:[function(e,t,o){"use strict";cc._RF.push(t,"9fe4bKr7mpG0bsBBy8l/IC9","StoreService"),Object.defineProperty(o,"__esModule",{value:!0}),o.StoreService=void 0,o.StoreService=class{storeGameProcess(e){return console.log(e),Promise.resolve("stored-game-data-key")}restoreGameProcess(e){return console.log(e),Promise.resolve('{ "game_process": {} }')}},cc._RF.pop()},{}],StrategiesProvider:[function(e,t,o){"use strict";cc._RF.push(t,"2154b+oIT1Oyp6bF+HeOljk","StrategiesProvider"),Object.defineProperty(o,"__esModule",{value:!0}),o.StrategiesProvider=void 0;const s=e("game/boosts/BoostID"),a=e("game/event/EventID"),i=e("game/GameStatus"),r=e("game/logic/blocks/actions/block-action-provider"),c=e("game/logic/blocks/BlockColorType"),n=e("game/logic/field/methods/FallDownFromBlocksMethod"),l=e("game/logic/field/methods/FallDownToBlocksMethod"),d=e("game/logic/field/methods/FillFullBoardMethod"),u=e("game/logic/field/methods/PickRandomBlocksMethod"),p=e("game/logic/field/methods/ProcessBlocksByInitialOneMethod"),h=e("game/logic/field/methods/ProcessBoostBombMethod"),m=e("game/logic/field/methods/ProcessBoostTeleportMethod"),_=e("game/logic/field/methods/RefillBoardMethod"),v=e("game/logic/reward/calculate-reward-by-scores-provider"),f=e("game/logic/score/calculation/calculate-score-by-block"),y=e("game/logic/score/calculation/calculation-score-by-wave"),g=e("game/state/GameFlowStateID"),P=e("game/state/strategies/BoostUpdateGameField"),b=e("game/state/strategies/CancelAllActiveActions"),B=e("game/state/strategies/GameResolveStatus"),S=e("game/state/strategies/PlayerHandleBoostActivated"),k=e("game/state/strategies/PlayerHandleLostStatus"),R=e("game/state/strategies/PlayerHandleResultComplete"),A=e("game/state/strategies/PlayerHandleTurnModeEnded"),T=e("game/state/strategies/PlayerWaitTurnAction"),M=e("game/state/strategies/UIInitialiseToStart"),C=e("game/state/strategies/UserStoreGameProcess"),w=e("game/turn_cycle/GameResultResolver"),F=e("./strategies/BoardPrepareToGame"),I=e("./strategies/BoardRefillEmptySectors"),O=e("./strategies/PlayerCalculateTurnResult"),D=e("./strategies/PlayerHandleWinStatus");o.StrategiesProvider=class{constructor(e){this.provideIdleStrategy=()=>({perform:()=>Promise.resolve()}),this.provideNextTurnStrategy=()=>({perform:()=>this._gameCtx.eventEmitter.emit(a.GameplayEventID.NEXT_TURN,void 0)}),this.provideGameStatusStrategy=()=>({perform:()=>{const e=this._gameCtx.gameProcess.gameProcessModelProvider();switch(e.status){case i.GameStatus.READY:case i.GameStatus.CONTINUE:return this._gameCtx.eventEmitter.emit(a.GameplayEventID.REFILL_BOARD,void 0);case i.GameStatus.WIN_STATUS:return this._gameCtx.eventEmitter.emit(a.GameplayEventID.PLAYER_WON,void 0);case i.GameStatus.LOSE_STATUS:return this._gameCtx.eventEmitter.emit(a.GameplayEventID.PLAYER_LOST,void 0);default:assertNever(e.status)}}}),this.provideGameEndStrategy=()=>({perform:()=>this._gameCtx.eventEmitter.emit(a.GameplayEventID.GAME_END,void 0)}),this._gameCtx=e}getStrategies(e,t){const o=this._gameCtx,s=this._gameCtx.gameProcess,a=this._gameCtx.settings.currLevel(),i=o.systems.actions.provide(e),c=()=>o.systems.actions.release(i);switch(e){case g.GameplayStateID.BOARD_READY:return[[new M.UIInitialiseToStart(s.gameProcessResultObservers,s.gameProcessModelProvider),new F.BoardPrepareToGame(o.boardView,new d.FillFullBoardMethod(o.boardDataProvider,o.boardDataEditor,new _.RefillBoardMethod(o.boardDataProvider,o.boardDataEditor,a))),this.provideNextTurnStrategy()],this._getDefaultExitStrategies(!0,i,c)];case g.GameplayStateID.BOARD_UPDATE:return[[new I.BoardRefillEmptySectors(o.boardView,new n.FallDownFromBlocksMethod(o.boardDataProvider),new l.FallDownToBlocksMethod(o.boardDataProvider,o.boardDataEditor,new n.FallDownFromBlocksMethod(o.boardDataProvider)),new _.RefillBoardMethod(o.boardDataProvider,o.boardDataEditor,a)),this.provideNextTurnStrategy()],this._getDefaultExitStrategies(!0,i,c)];case g.GameplayStateID.PLAYER_TURN:return[[new T.PlayerWaitTurnAction(o.boardView,new u.PickRandomBlocksMethod(o.boardDataProvider,{blocksToPickMin:a.behaviour.BLOCKS_TO_IDLE_SHAKE_MIN,blocksToPickMax:a.behaviour.BLOCKS_TO_IDLE_SHAKE_MAX,maxBlocksAtOneWave:a.behaviour.MAX_BLOCKS_AT_ONE_IDLE_SHAKE_WAVE})),this.provideIdleStrategy()],this._getDefaultExitStrategies(!1,i,c)];case g.GameplayStateID.PLAYER_BOOST:const h=t;return[[new S.PlayerHandleBoostActivated(h.boost,s.gameProcessResultAgent,s.gameProcessModelProvider,s.playerTurnFlowActorsOrderedList),new P.BoostUpdateGameField(h.boost,o.boardView,s.playerTurnModelProvider,this._getBoostUpdateMethod(h.boost)),new R.PlayerHandleResultComplete(s.playerTurnModelProvider,s.gameProcessModelProvider,s.playerTurnFlowActorsOrderedList),new C.UserStoreGameProcess(o.boardDataProvider,s.gameProcessModelProvider,o.services.gameProcessMapper,o.services.storeService,o.services.userProgressSaveService),new B.GameResolveStatus(s.gameProcessModelProvider,s.gameProcessResultAgent,new w.GameResultResolver,s.gameProcessResultObservers),this.provideGameStatusStrategy()],this._getDefaultExitStrategies(!0,i,c)];case g.GameplayStateID.PLAYER_RESULT:const m=t;return[[new A.PlayerHandleTurnModeEnded(s.gameProcessModelProvider,s.playerTurnFlowActorsOrderedList),new O.PlayerCalculateTurnResult(o.boardView,s.playerTurnModelProvider,new p.ProcessBlocksByInitialOneMethod(o.boardDataProvider,o.boardDataEditor,m.activeBlock,s.playerTurnModelProvider,s.playerTurnResultAgent,e=>r.blockActionProvider(e,o.settings.gameplay),()=>({scoreByBlock:f.calculateScoreByBlock,scoreByWave:y.calculationScoreByWave}),()=>v.calculateRewardByScoresProvider(a))),new R.PlayerHandleResultComplete(s.playerTurnModelProvider,s.gameProcessModelProvider,s.playerTurnFlowActorsOrderedList),new C.UserStoreGameProcess(o.boardDataProvider,s.gameProcessModelProvider,o.services.gameProcessMapper,o.services.storeService,o.services.userProgressSaveService),new B.GameResolveStatus(s.gameProcessModelProvider,s.gameProcessResultAgent,new w.GameResultResolver,s.gameProcessResultObservers),this.provideGameStatusStrategy()],this._getDefaultExitStrategies(!0,i,c)];case g.GameplayStateID.PLAYER_WIN:return[[new D.PlayerHandleWinStatus,this.provideGameEndStrategy()],this._getDefaultExitStrategies(!1,i,c)];case g.GameplayStateID.PLAYER_LOSE:return[[new k.PlayerHandleLostStatus,this.provideGameEndStrategy()],this._getDefaultExitStrategies(!1,i,c)];default:assertNever(e)}}_getBoostUpdateMethod(e){const t=this._gameCtx,o=this._gameCtx.gameProcess,a=this._gameCtx.settings.gameplay,i=this._gameCtx.settings.currLevel(),r=this._gameCtx.boardDataProvider();switch(e){case s.GameplayBoostID.TELEPORT:return new m.ProcessBoostTeleportMethod(t.boardDataProvider,t.boardDataEditor,new u.PickRandomBlocksMethod(t.boardDataProvider,{blocksToPickMin:a.boosts.teleport.BLOCKS_TO_ACTIVATE_MIN||r.rows*r.columns,blocksToPickMax:a.boosts.teleport.BLOCKS_TO_ACTIVATE_MAX,maxBlocksAtOneWave:a.boosts.teleport.MAX_BLOCKS_AT_ONE_WAVE},e=>c.isSimpleBlock(e)));case s.GameplayBoostID.BOMB:return new h.ProcessBoostBombMethod(t.boardDataProvider,t.boardDataEditor,o.playerTurnModelProvider,o.playerTurnResultAgent,()=>({scoreByBlock:f.calculateScoreByBlock,scoreByWave:y.calculationScoreByBombBoostWave}),()=>v.calculateRewardByBombBoostProvider(i));default:assertNever(e)}}_getDefaultExitStrategies(e,t,o){return[new b.CancelAllActiveActions(t,e,o)]}},cc._RF.pop()},{"./strategies/BoardPrepareToGame":"BoardPrepareToGame","./strategies/BoardRefillEmptySectors":"BoardRefillEmptySectors","./strategies/PlayerCalculateTurnResult":"PlayerCalculateTurnResult","./strategies/PlayerHandleWinStatus":"PlayerHandleWinStatus","game/GameStatus":void 0,"game/boosts/BoostID":void 0,"game/event/EventID":void 0,"game/logic/blocks/BlockColorType":void 0,"game/logic/blocks/actions/block-action-provider":void 0,"game/logic/field/methods/FallDownFromBlocksMethod":void 0,"game/logic/field/methods/FallDownToBlocksMethod":void 0,"game/logic/field/methods/FillFullBoardMethod":void 0,"game/logic/field/methods/PickRandomBlocksMethod":void 0,"game/logic/field/methods/ProcessBlocksByInitialOneMethod":void 0,"game/logic/field/methods/ProcessBoostBombMethod":void 0,"game/logic/field/methods/ProcessBoostTeleportMethod":void 0,"game/logic/field/methods/RefillBoardMethod":void 0,"game/logic/reward/calculate-reward-by-scores-provider":void 0,"game/logic/score/calculation/calculate-score-by-block":void 0,"game/logic/score/calculation/calculation-score-by-wave":void 0,"game/state/GameFlowStateID":void 0,"game/state/strategies/BoostUpdateGameField":void 0,"game/state/strategies/CancelAllActiveActions":void 0,"game/state/strategies/GameResolveStatus":void 0,"game/state/strategies/PlayerHandleBoostActivated":void 0,"game/state/strategies/PlayerHandleLostStatus":void 0,"game/state/strategies/PlayerHandleResultComplete":void 0,"game/state/strategies/PlayerHandleTurnModeEnded":void 0,"game/state/strategies/PlayerWaitTurnAction":void 0,"game/state/strategies/UIInitialiseToStart":void 0,"game/state/strategies/UserStoreGameProcess":void 0,"game/turn_cycle/GameResultResolver":void 0}],TurnsCounter:[function(e,t,o){"use strict";cc._RF.push(t,"362ebl3YBtLM5InhideprlN","TurnsCounter");var s=this&&this.__decorate||function(e,t,o,s){var a,i=arguments.length,r=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,s);else for(var c=e.length-1;c>=0;c--)(a=e[c])&&(r=(i<3?a(r):i>3?a(t,o,r):a(t,o))||r);return i>3&&r&&Object.defineProperty(t,o,r),r};Object.defineProperty(o,"__esModule",{value:!0}),o.TurnsCounter=void 0;let a=class extends cc.Component{};a=s([cc._decorator.ccclass,cc._decorator.disallowMultiple],a),o.TurnsCounter=a,cc._RF.pop()},{}],UIInitialiseToStart:[function(e,t,o){"use strict";cc._RF.push(t,"924fd5K5QdO1a+7382+S84z","UIInitialiseToStart"),Object.defineProperty(o,"__esModule",{value:!0}),o.UIInitialiseToStart=void 0,o.UIInitialiseToStart=class{constructor(e,t){this._uiUpdaters=e,this._gameProcessResultProvider=t}perform(){const e=[],t=this._gameProcessResultProvider();for(const o of this._uiUpdaters)e.push(o.onGameProcessUpdate(t));return Promise.all(e).then()}},cc._RF.pop()},{}],UserService:[function(e,t,o){"use strict";cc._RF.push(t,"62a7coBVadOiax9Hecm16yw","UserService"),Object.defineProperty(o,"__esModule",{value:!0}),o.UserService=void 0,o.UserService=class{saveUserProgress(e,t){return console.log(e,t),Promise.resolve()}loadUserProgress(){return Promise.resolve(['{ "user_profile": {} }',"stored-game-data-key"])}},cc._RF.pop()},{}],UserStoreGameProcess:[function(e,t,o){"use strict";cc._RF.push(t,"99d9dLb09VMyp4N2owH9alU","UserStoreGameProcess");var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))(function(a,i){function r(e){try{n(s.next(e))}catch(t){i(t)}}function c(e){try{n(s.throw(e))}catch(t){i(t)}}function n(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(r,c)}n((s=s.apply(e,t||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0}),o.UserStoreGameProcess=void 0,o.UserStoreGameProcess=class{constructor(e,t,o,s,a){this._fieldProvider=e,this._gameProcessResultProvider=t,this._mapper=o,this._storeService=s,this._userService=a}perform(){return s(this,void 0,void 0,function*(){const e=this._mapper.serialize(this._fieldProvider(),this._gameProcessResultProvider()),t=yield this._storeService.storeGameProcess(e);yield this._userService.saveUserProgress("",t)})}},cc._RF.pop()},{}],"action-types":[function(e,t,o){"use strict";cc._RF.push(t,"74397Q44O9H9LamLXuBWGb1","action-types"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],"animation-types":[function(e,t,o){"use strict";cc._RF.push(t,"d41beFfpFtG+Js0qpxbuPK3","animation-types"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],"app-settings":[function(e,t,o){"use strict";cc._RF.push(t,"1b7e4E62w1Ido2x0nP8qqZq","app-settings"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],"audio-types":[function(e,t,o){"use strict";cc._RF.push(t,"5c0b8GM3SVAAbz2sLANNaH8","audio-types"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],"base-types":[function(e,t,o){"use strict";cc._RF.push(t,"9f8fc8SFNxPf7DgHQVZiqAF","base-types"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],"block-action-provider":[function(e,t,o){"use strict";cc._RF.push(t,"117faG/8kxFU6xQNxVizUuJ","block-action-provider"),Object.defineProperty(o,"__esModule",{value:!0}),o.blockActionProvider=void 0;const s=e("game/logic/blocks/actions/SimpleBlockAction"),a=e("game/logic/blocks/actions/special/special-block-activator-provider"),i=e("game/logic/blocks/actions/SpecialBlockAction"),r=e("game/logic/blocks/BlockColorType"),c=e("game/logic/blocks/BlockSpecialType");o.blockActionProvider=(e,t)=>{if(r.isSimpleBlock(e))switch(e){case r.BlockColorType.RED:case r.BlockColorType.YELLOW:case r.BlockColorType.GREEN:case r.BlockColorType.PINK:case r.BlockColorType.BLUE:return new s.SimpleBlockAction(e)}else if(c.isSpecialBlock(e))return new i.SpecialBlockAction(e,a.specialBlockActivatorProvider(e,t),e=>a.specialBlockActivatorProvider(e,t));assertNever(e)},cc._RF.pop()},{"game/logic/blocks/BlockColorType":void 0,"game/logic/blocks/BlockSpecialType":void 0,"game/logic/blocks/actions/SimpleBlockAction":void 0,"game/logic/blocks/actions/SpecialBlockAction":void 0,"game/logic/blocks/actions/special/special-block-activator-provider":void 0}],"calculate-reward-by-scores-provider":[function(e,t,o){"use strict";cc._RF.push(t,"b0552xHon9DU5mUC9xetDPE","calculate-reward-by-scores-provider"),Object.defineProperty(o,"__esModule",{value:!0}),o.calculateRewardByBombBoostProvider=o.calculateRewardByScoresProvider=void 0;const s=e("game/boosts/BoostID");o.calculateRewardByScoresProvider=e=>(t,o)=>{const a={boosterTeleport:0,boosterBomb:0},i=Object.values(s.GameplayBoostID);for(const r of i)switch(r){case s.GameplayBoostID.TELEPORT:const i=t/e.reward.TELEPORT_BOOST_FOR_EACH_SCORE_MORE_THAN+o.length*e.reward.TELEPORT_BOOST_EACH_WAVE_CAPACITY;a.boosterTeleport+=0|i;break;case s.GameplayBoostID.BOMB:const c=t/e.reward.BOMB_BOOST_FOR_EACH_SCORE_MORE_THAN+o.length*e.reward.BOMB_BOOST_EACH_WAVE_CAPACITY;a.boosterBomb+=0|c;break;default:assertNever(r)}return a},o.calculateRewardByBombBoostProvider=e=>(t,o)=>{const a={boosterTeleport:0,boosterBomb:0},i=Object.values(s.GameplayBoostID);for(const r of i)switch(r){case s.GameplayBoostID.TELEPORT:const i=t/e.reward.usingBombBooster.TELEPORT_BOOST_FOR_EACH_SCORE_MORE_THAN/10+o.length*e.reward.usingBombBooster.TELEPORT_BOOST_EACH_WAVE_CAPACITY/10;a.boosterTeleport+=0|i;break;case s.GameplayBoostID.BOMB:const c=t/e.reward.usingBombBooster.BOMB_BOOST_FOR_EACH_SCORE_MORE_THAN/10+o.length*e.reward.usingBombBooster.BOMB_BOOST_EACH_WAVE_CAPACITY/10;a.boosterBomb+=0|c;break;default:assertNever(r)}return a},cc._RF.pop()},{"game/boosts/BoostID":void 0}],"calculate-score-by-block":[function(e,t,o){"use strict";cc._RF.push(t,"b78719RcHZAUalMvqor/KZx","calculate-score-by-block"),Object.defineProperty(o,"__esModule",{value:!0}),o.calculateScoreByBlock=void 0;const s=e("game/logic/blocks/BlockColorType"),a=e("game/logic/blocks/BlockSpecialType");o.calculateScoreByBlock=e=>{if(s.isSimpleBlock(e))switch(e){case s.BlockColorType.RED:case s.BlockColorType.YELLOW:case s.BlockColorType.GREEN:case s.BlockColorType.PINK:case s.BlockColorType.BLUE:return 1}else if(a.isSpecialBlock(e))switch(e){case a.BlockSpecialType.BOMB:case a.BlockSpecialType.BOMB_MAX:return 0;case a.BlockSpecialType.ROCKET_HORIZONTAL:case a.BlockSpecialType.ROCKET_VERTICAL:return 0}assertNever(e)},cc._RF.pop()},{"game/logic/blocks/BlockColorType":void 0,"game/logic/blocks/BlockSpecialType":void 0}],"calculation-score-by-wave":[function(e,t,o){"use strict";cc._RF.push(t,"9ea19kb0KZFUrAKLDjNHXjn","calculation-score-by-wave"),Object.defineProperty(o,"__esModule",{value:!0}),o.calculationScoreByBombBoostWave=o.calculationScoreByWave=void 0;const s=[0,0,10,20,30,40,50],a=[0,0,2,4,6,8,10];o.calculationScoreByWave=(e,t)=>{const o=[];for(let a=0;a<e.length;a++){let e=.5*Math.max(0,0|t);e+=t<s.length?s[t]:90,o.push(e)}return o},o.calculationScoreByBombBoostWave=(e,t)=>{const o=[];for(let s=0;s<e.length;s++){let e=.5*Math.max(0,0|t);e+=t<a.length?a[t]:20,o.push(e)}return o},cc._RF.pop()},{}],easings:[function(e,t,o){"use strict";cc._RF.push(t,"0872cber2lFrL11C/Jelo0t","easings"),Object.defineProperty(o,"__esModule",{value:!0}),o.CubicInOut=o.CubicOut=o.CubicIn=o.QuadInOut=o.QuadOut=o.QuadIn=o.LineInOut=void 0;const s=e=>e*e,a=e=>e*(2-e),i=e=>e<.5?2*e*e:(4-2*e)*e-1,r=e=>e*e*e,c=e=>3*e-3*e*e+e*e*e,n=e=>e<.5?4*e*e*e:4*e*e*e-12*e*e+12*e-3;o.LineInOut=(e,t,o)=>e+(t-e)*o,o.QuadIn=(e,t,o)=>e+(t-e)*s(o),o.QuadOut=(e,t,o)=>e+(t-e)*a(o),o.QuadInOut=(e,t,o)=>e+(t-e)*i(o),o.CubicIn=(e,t,o)=>e+(t-e)*r(o),o.CubicOut=(e,t,o)=>e+(t-e)*c(o),o.CubicInOut=(e,t,o)=>e+(t-e)*n(o),cc._RF.pop()},{}],"event-api":[function(e,t,o){"use strict";cc._RF.push(t,"3eb88N3d9FG1boVHVoozNTW","event-api"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],"event-types":[function(e,t,o){"use strict";cc._RF.push(t,"ea4ae3HMdBKjYmJ+qDeBNHt","event-types"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],"game-api":[function(e,t,o){"use strict";cc._RF.push(t,"b4fdcA6fwNNCYMvxLUuYiQ8","game-api"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],"game-flow-state":[function(e,t,o){"use strict";cc._RF.push(t,"62361CL7mZNobkW3ZbKWBG/","game-flow-state"),Object.defineProperty(o,"__esModule",{value:!0}),o.ignoreTransition=o.transitionBlockedResult=void 0,o.transitionBlockedResult=()=>Promise.resolve(void 0),o.ignoreTransition=()=>Promise.resolve(void 0),cc._RF.pop()},{}],"game-settings":[function(e,t,o){"use strict";cc._RF.push(t,"5bb36bvNlVI1ZvLbEw/Ri4t","game-settings"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],"gameloop-types":[function(e,t,o){"use strict";cc._RF.push(t,"2780eDc1RpAtqIOijkRnvyb","gameloop-types"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],"global-init":[function(e,t,o){(function(e){"use strict";var s;cc._RF.push(t,"f5c17sHRI1GZL7ZBolm9ol7","global-init"),Object.defineProperty(o,"__esModule",{value:!0}),o.assertProp=void 0,console.info("!!GLOBAL INITIALIZED!!");const a=e||window;a.ccMax8BitValue=255,a.wait||(a.wait=function(e){return new Promise(t=>setTimeout(t,e))}),a.cc=a.cc||{},(s=a.cc).assertProp||(s.assertProp=function(e,t,o){return new Promise(e=>setTimeout(e,1e3)).then(()=>{let s,a;!0===t?(s=null==o?void 0:o(),a=`[cc.assertProp] Some private/protected property is missing on component named '${e.name}'!`):(s=e[t],a=`[cc.assertProp] Property "${String(t)}" is missing on component named '${e.name}'!`),null==s&&console.error(a)}),null}),o.assertProp=a.cc.assertProp,cc._RF.pop()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],"input-types":[function(e,t,o){"use strict";cc._RF.push(t,"598da6HBdtKBKs/w+sAn2Xb","input-types"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],"level-settings":[function(e,t,o){"use strict";cc._RF.push(t,"1ec4fqQBIxDW4UlAd8D/cF/","level-settings"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],"logic-api":[function(e,t,o){"use strict";cc._RF.push(t,"da488dLnqpFN7uha/6s4kxu","logic-api"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],"service-types":[function(e,t,o){"use strict";cc._RF.push(t,"85a9d9K1r5Jxait5KcmgQe+","service-types"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],"special-block-activator-provider":[function(e,t,o){"use strict";cc._RF.push(t,"221c9sGOwtMLpitMMtNX3Vk","special-block-activator-provider"),Object.defineProperty(o,"__esModule",{value:!0}),o.specialBlockActivatorProvider=void 0;const s=e("game/logic/blocks/actions/special/BombActivator"),a=e("game/logic/blocks/actions/special/RocketActivator"),i=e("game/logic/blocks/BlockSpecialType"),r=e("game/logic/blocks/special/RocketType");o.specialBlockActivatorProvider=(e,t)=>e==i.BlockSpecialType.BOMB?new s.BombActivator(t.gamefield.blocks.special.bomb.BOMB_WAVE_RADIUS,t.gamefield.blocks.special.bomb.BOMB_INCLUDE_DIAGONALS):e==i.BlockSpecialType.BOMB_MAX?new s.BombActivator(t.gamefield.blocks.special.bomb.BOMB_MAX_WAVE_RADIUS,t.gamefield.blocks.special.bomb.BOMB_MAX_INCLUDE_DIAGONALS):e==i.BlockSpecialType.ROCKET_HORIZONTAL?new a.RocketActivator(r.RocketType.HORIZONTAL,t.gamefield.blocks.special.rocket.LINE_DISTANCE):e==i.BlockSpecialType.ROCKET_VERTICAL?new a.RocketActivator(r.RocketType.VERTICAL,t.gamefield.blocks.special.rocket.LINE_DISTANCE):void assertNever(e),cc._RF.pop()},{"game/logic/blocks/BlockSpecialType":void 0,"game/logic/blocks/actions/special/BombActivator":void 0,"game/logic/blocks/actions/special/RocketActivator":void 0,"game/logic/blocks/special/RocketType":void 0}],"states-api":[function(e,t,o){"use strict";cc._RF.push(t,"db4474q0e9OmIvoL8XX8lVr","states-api"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],"system-types":[function(e,t,o){"use strict";cc._RF.push(t,"31e80551sREYIkDPEocEF0z","system-types"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}]},{},["Main","action-types","animation-types","app-settings","audio-types","base-types","event-types","gameloop-types","input-types","service-types","system-types","EventBus","GameLoop","GameLoopPhase","GameTime","PauseManager","Action","ActionManager","CounterAction","DelayAction","DelayOutLoopAction","easings","AnimationManager","AudioVoice","MusicManager","Sound","SoundsManager","StoreService","UserService","GameFlowControl","GameStatus","event-api","game-api","game-settings","level-settings","logic-api","states-api","BoostID","EventID","BlockColorType","BlockSpecialType","BlocksField","BlockActionBase","SimpleBlockAction","SpecialBlockAction","block-action-provider","BombActivator","RocketActivator","special-block-activator-provider","RocketType","FieldData","FieldDataIterable","FallDownFromBlocksMethod","FallDownToBlocksMethod","FillFullBoardMethod","PickRandomBlocksMethod","ProcessBlocksByInitialOneMethod","ProcessBoostBombMethod","ProcessBoostTeleportMethod","RefillBoardMethod","ShakeToBlocksMethod","calculate-reward-by-scores-provider","ScoreFieldData","calculate-score-by-block","calculation-score-by-wave","GameProcessMapper","GameFlowStateBase","GameFlowStateID","StatesFactory","StrategiesProvider","game-flow-state","BoardReady","BoardUpdate","PlayerBoost","PlayerLoseState","PlayerResultState","PlayerTurnState","PlayerWinState","BoardPrepareToGame","BoardRefillEmptySectors","BoostUpdateGameField","CancelAllActiveActions","CancelAllActiveAnimations","GameResolveStatus","PlayerCalculateTurnResult","PlayerHandleBoostActivated","PlayerHandleLostStatus","PlayerHandleResultComplete","PlayerHandleTurnModeEnded","PlayerHandleWinStatus","PlayerWaitTurnAction","UIInitialiseToStart","UserStoreGameProcess","GameProcessModel","GameResultResolver","PlayerTurnModel","BoardUI","BoostsUI","HudUI","global-init","Board","Boosters","Hud","TurnsCounter","BlocksPreview","CCParallelAnimationPlayer","CCSequentAnimationPlayer","CCAudioPlayer","CCGameLoopUpdateAgent","Block","BlocksSet","ScoreInfo","ScoresSet"]);